$(document).ready(function(){addEventForBanFormBtn();addEventForUnbanFormBtn();addEventForItemUpdateBtn();addEventForNowBtn();addEventForBanBtn();addEventForBanTimeInput();addEventForPermanentBanBtn();addConfirmEvent();$(".banTime").trigger("blur");addEventForBanItemBtn();addEventForBanShopBtn();addEventForCollectionSave();addEventForTagSave();addEventForTagDel()});
function addEventForBanBtn(){$(".ban-btn").click(function(a){a.preventDefault();a=$(this).attr("user_id");"封禁"==$("#ban-btn-text_"+a).text()?openBox.show("fjyh_"+a):openBox.show("jjyh_"+a)})}
function addEventForBanFormBtn(){$(".form-ban-btn").click(function(a){a.preventDefault();a.stopPropagation();a=$(this).attr("user_id");$.ajax({url:$(".form-ban-user").attr("action"),dataType:"json",data:{username:$("#username_"+a).val(),banTime:$("#banTime_"+a).val(),banPermanent:$("#banPermanent_"+a).is(":checked")?1:0,hideAllItems:$("#hideAllItems_"+a).is(":checked")?1:0,sendPM:$("#sendPM_"+a).is(":checked")?1:0,pm:$("#pm_"+a).val()},success:function(a){alert(a.status.message);"200"==a.status.code&&
($("#fjyh_"+a.user_id).hide(),openBox.hide("fjyh_"+a.user_id),$("#ban-btn-text_"+a.user_id).text("解禁"),a.data.ban_permanent?$("[data-id=ban-status]_"+a.user_id+"]").text("永久封禁"):$("[data-id=ban-status_"+a.user_id+"]").text("封禁剩余"+a.data.time_remains+"天"))}})})}
function addEventForUnbanFormBtn(){$(".form-unban-btn").click(function(a){a.preventDefault();a.stopPropagation();a=$(this).attr("user_id");$.ajax({url:$("#form-unban-user_"+a).attr("action"),dataType:"json",data:{username:$("#unban-username_"+a).val(),showAllItems:$("#unban-showAllItems_"+a).is(":checked")?1:0,sendPM:$("#unban-sendPM_"+a).is(":checked")?1:0,pm:$("#unban-pm_"+a).val()},success:function(a){alert(a.status.message);"200"==a.status.code&&($("#jjyh_"+a.user_id).hide(),openBox.hide("jjyh_"+
a.user_id),$("#ban-btn-text").text("封禁"),$("[data-id=ban-status]").text("正常"))}})})}function addEventForNowBtn(){$("#btn-now").click(function(a){a.preventDefault();$("#publishTime").datetimepicker("setDate",new Date)})}
function addEventForItemUpdateBtn(){$("#item-update-btn").click(function(a){a.preventDefault();a.stopPropagation();$.ajax({url:$("#form-update-item").attr("action"),dataType:"json",data:{itemId:$("#itemId").val(),publishTime:$("#publishTime").val(),isVerified:$("#isVerified").is(":checked")?1:0,isHide:$("#isHide").is(":checked")?1:0,isSoldOut:$("#isSoldOut").is(":checked")?1:0},success:function(a){alert(a.status.message)}})})}
function addEventForBanTimeInput(){$(".banTime").bind("change blur",function(){var a=$(this).attr("user_id"),b=$(this).attr("user_name"),a=$("#pm_"+a),c=a.data("message"),c=c.replace("{{days}}","封禁"+$.trim($(this).val())+"天"),c=c.replace("{{hupuUsername}}",b);a.val(c)});$(".banTime").keydown(function(a){46==a.keyCode||(8==a.keyCode||9==a.keyCode||27==a.keyCode||13==a.keyCode||65==a.keyCode&&!0===a.ctrlKey||35<=a.keyCode&&39>=a.keyCode)||(a.shiftKey||(48>a.keyCode||57<a.keyCode)&&(96>a.keyCode||105<
a.keyCode))&&a.preventDefault()})}function addEventForPermanentBanBtn(){$(".banPermanent").click(function(){if($(this).is(":checked")){var a=$(this).attr("user_id"),b=$("#pm_"+a),c=b.data("message"),c=c.replace("{{days}}","永久封禁");b.val(c);$("#banTime_"+a).prop("disabled",!0)}else a=$(this).attr("user_id"),$("#banTime_"+a).prop("disabled",!1),$("#banTime_"+a+a).trigger("blur")})}
function addConfirmEvent(){$("[data-confirm]").click(function(a){($result=$(this).is(":checked")?confirm($(this).data("message-check")):confirm($(this).data("message-uncheck")))||a.preventDefault()})}
function addEventForBanItemBtn(){$("#btn-ban-item").click(function(a){a.preventDefault();a.stopPropagation();$that=$(this);confirm("确定要 "+$($that.data("target")).text())&&$.ajax($that.data("action"),{data:{itemId:$("#itemId").val(),status:0==$("#item-status").val()?1:0},dataType:"json",success:function(a){alert(a.status.message);"200"==a.status.code&&(1==$("#item-status").val()?($("#item-status").val(0),$($that.data("target")).text($that.data("text-0"))):($("#item-status").val(1),$($that.data("target")).text($that.data("text-1"))))}})})}
function addEventForBanShopBtn(){$("#btn-ban-shop").click(function(a){a.preventDefault();a.stopPropagation();$that=$(this);confirm("确定要 "+$($that.data("target")).text())&&$.ajax($that.data("action"),{data:{shopId:$("#shop-id").val(),status:0==$("#shop-status").val()?1:0},dataType:"json",success:function(a){alert(a.status.message);"200"==a.status.code&&(1==$("#shop-status").val()?($("#shop-status").val(0),$($that.data("target")).text($that.data("text-0"))):($("#shop-status").val(1),$($that.data("target")).text($that.data("text-1"))))}})})}
function addEventForCollectionSave(){$("#add_to_collection").submit(function(a){a.preventDefault();var a=$(this).attr("action"),b=$(this).serialize();$.post(a,b,function(a){0==a.status&&alert("操作成功")},"json")})}function addEventForTagSave(){$("#add_to_tag").submit(function(a){a.preventDefault();var a=$(this).attr("action"),b=$(this).serialize();$.post(a,b,function(a){0==a.status&&(alert("操作成功"),window.location.reload())},"json")})}
function addEventForTagDel(){$(".tag_del").click(function(a){var b=$(this);a.preventDefault();a=$(this).attr("href");$.get(a,{},function(a){0==a.status&&(alert("操作成功"),b.parent().hide())},"json")})};
