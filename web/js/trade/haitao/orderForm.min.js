/** 
 * @Description: shihuo 
 * @author: lanyang 
 * @Update: 2015-11-19 20:11 
 */ 
$(function(){orderConfirm.init(),submit.init(),lodingData.init()});var lodingData={init:function(){1*updateFlag==1&&($.Jui._showMasks(.8),$("#loding-box").css({left:$.Jui._position($("#loding-box"))[0],top:$.Jui._position($("#loding-box"))[1]}).show(),this.postJson())},postJson:function(){$.post("http://www.shihuo.cn/haitao/updateProductInfo",{productId:productId,goodsId:goodsId},function(a){1*a.status==0?$("#up-data").submit():($.Jui._closeMasks(),$("#loding-box").hide())},"json")}},myCardLayer={init:function(){$.Jui._showMasks(.6),$(".write-card").css({left:$.Jui._position($(".write-card"))[0],top:$.Jui._position($(".write-card"))[1]-$.Jui._getpageScroll()}).show(),this.bindFun()},bindFun:function(){var a=/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;$(".write-card").find("i").click(function(){$(".write-card").hide(),$.Jui._closeMasks()}),$(".write-card").find(".submit-btn-card").click(function(){var b=$("#my_card").val(),c=$(this);a.test(b)===!1?$(this).tips("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u8eab\u4efd\u8bc1\u53f7\u7801",{left:$(this).offset().left,top:$(this).offset().top-30}):$.post("http://www.shihuo.cn/haitao/saveIdentityNumber",{identity_number:b,address_id:priceValue.address_id},function(a){1*a.status==0?($(".write-card").hide(),$.Jui._closeMasks()):c.tips(a.msg,{left:c.offset().left,top:c.offset().top-30})},"json")})}},orderConfirm={Verification:{name:!1,card:!1,phone:!1,tell:!1,detailed:!1,postal:!1},init:function(){this.bindFun(),this.cityAdd(),this.remark(),this.express()},bindFun:function(){function a(){var a=$("input[name='phonesection']").data("check"),b=$("input[name='phonecode']").data("check"),c=$("input[name='phoneext']").data("check");a&&b?0==c?f.Verification.tell=!1:f.Verification.tell=!0:f.Verification.tell=!1}var b=/^1[34578][0-9]{9}$/,c=/^[0-9]{3,6}$/,d=/^[0-9]{5,10}$/,e=/^[0-9]{0,5}$/,f=this;$(".checkhaitao").click(function(){var a=$(this).attr("checked");"checked"!=a?$(".submit-btn").addClass("submit-btnCC"):$(".submit-btn").removeClass("submit-btnCC")}),$("input[name='name']").blur(function(){var a=$(this).val();""==$.trim(a)?$(this).tips("\u8bf7\u586b\u5199\u59d3\u540d",{left:$(this).offset().left+$(this).outerWidth()+10,top:$(this).offset().top}):f.Verification.name=!0}),$("input[name='card']").blur(function(){var a=$(this).val(),b=/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;b.test(a)===!1?$(this).tips("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u8eab\u4efd\u8bc1",{left:$(this).offset().left+$(this).outerWidth()+10,top:$(this).offset().top}):f.Verification.card=!0}),$("input[name='phone']").blur(function(){var a=$(this).val();b.test(a)?f.Verification.phone=!0:$(this).tips("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u624b\u673a\u53f7\u7801",{left:$(this).offset().left+$(this).outerWidth()+10,top:$(this).offset().top})}),$("input[name='phonesection']").blur(function(){var b=$(this).val();c.test(b)||""==$.trim(b)?$(this).data("check",!0):($(this).tips("\u533a\u53f7\u5fc5\u987b\u4e3a3\u52306\u4f4d\u6570\u5b57",{left:$(this).offset().left+$(this).outerWidth()+10,top:$(this).offset().top}),$(this).data("check",!1)),a()}),$("input[name='phonecode']").blur(function(){var b=$(this).val();d.test(b)||""==$.trim(b)?$(this).data("check",!0):($(this).tips("\u7535\u8bdd\u5fc5\u987b\u4e3a5\u523010\u4f4d\u6570\u5b57",{left:$(this).offset().left+$(this).outerWidth()+10,top:$(this).offset().top}),$(this).data("check",!1)),a()}),$("input[name='phoneext']").blur(function(){var b=$(this).val();e.test(b)||""==$.trim(b)?$(this).data("check",!0):($(this).tips("\u7535\u8bdd\u5206\u673a\u5fc5\u987b\u5c11\u4e8e6\u4e2a\u6570\u5b57",{left:$(this).offset().left+$(this).outerWidth()+10,top:$(this).offset().top}),$(this).data("check",!1)),a()}),$("input[name='detailed']").blur(function(){var a=$(this).val();""==$.trim(a)?$(this).tips("\u8bf7\u586b\u5199\u8be6\u7ec6\u5730\u5740",{left:$(this).offset().left+$(this).outerWidth()+10,top:$(this).offset().top}):f.Verification.detailed=!0}),$("input[name='postal']").blur(function(){var a=$(this).val();""==$.trim(a)?$(this).tips("\u8bf7\u586b\u5199\u90ae\u653f\u7f16\u7801",{left:$(this).offset().left+$(this).outerWidth()+10,top:$(this).offset().top}):f.Verification.postal=!0}),$("input[name='address']").change(function(a){priceValue.address_id=1*$(this).val(),getPrice.getJson()}),$(".new-address").find(".save").click(function(){var a=$(this),b=$("input[name='name']").val(),c=$("input[name='card']").val(),d=$("input[name='phone']").val(),e=$("input[name='phonesection']").val(),g=$("input[name='phonecode']").val(),h=$("input[name='phoneext']").val(),i=$(".sel-1").val(),j=$(".sel-2").val(),k=$(".sel-3").val(),l=$("input[name='detailed']").val(),m=$("input[name='postal']").val();return"checked"==$("input[name='defaultflag']").attr("checked")?defaultflagVal=1:defaultflagVal=0,f.Verification.name?f.Verification.card?f.Verification.phone?""==$.trim($("input[name='phonesection']").val())||""==$.trim($("input[name='phonecode']").val())||""==$.trim($("input[name='phoneext']").val())||f.Verification.tell?f.Verification.detailed?f.Verification.postal?void $.get("http://www.shihuo.cn/haitao/saveDeliveryAddress",{name:b,mobile:d,phonesection:e,phonecode:g,phoneext:h,province:i,city:j,area:k,street:l,postcode:m,defaultflag:defaultflagVal,identity_number:c},function(b){1*b.status==1?a.tips(b.msg):($(".addressBox").find("ul").eq(0).prepend('<li>                        <div class="clearfix">                            <div class="area-main">                                <input name="address" autocomplete="off" value="'+b.data.id+'" type="radio" /> '+b.data.address+"                            </div>                        </div>                    </li>"),$("input[name='address']").eq(0).attr("checked","checked"),priceValue.address_id=1*$("input[name='address']:checked").val(),$(".new-address").hide(),getPrice.getJson(),f.clearAddress())},"json"):($("input[name='postal']").blur(),!1):($("input[name='detailed']").blur(),!1):($("input[name='phonecode']").tips("\u8bf7\u6b63\u786e\u586b\u5199\u7535\u8bdd\u53f7\u7801",{left:$("input[name='phonecode']").offset().left+$(this).outerWidth()+10,top:$("input[name='phonecode']").offset().top}),!1):($("input[name='phone']").blur(),!1):($("input[name='card']").blur(),!1):($("input[name='name']").blur(),!1)}),$(".add_new_address").change(function(){$(".new-address").show()}),$(".coupon-box").find("li").click(function(){var a=$(this).attr("coupon_id"),b=$(this);b.hasClass("on")&&(a=""),$.post("http://www.shihuo.cn/haitao/orderDetailConfirmLipinka",{product_id:priceValue.productId,goods_id:priceValue.goodsId,num:priceValue.number,coupon_id:a},function(c){1*c.status==0&&(b.hasClass("on")?($("#price_up").html("\uffe5"+c.data.total_price),b.removeClass("on")):("1"==b.attr("check"),$("#price_up").html("\uffe5"+c.data.total_price),b.addClass("on"),b.siblings().removeClass("on")),priceValue.coupon_id=a)},"json")})},clearAddress:function(){$("input[name='name']").val(""),$("input[name='phone']").val(""),$("input[name='phonesection']").val(""),$("input[name='phonecode']").val(""),$("input[name='phoneext']").val(""),$("input[name='detailed']").val(""),$("input[name='postal']").val(""),$("input[name='defaultflag']").removeAttr("checked")},cityAdd:function(){var a=$(".select_city"),b=this;a.find(".sel-1").change(function(a){var c=$(this).val();$(".select_city").find(".sel-2").html('<option value="0">\u8bf7\u9009\u62e9</option>'),$(".select_city").find(".sel-3").html('<option value="0">\u8bf7\u9009\u62e9</option>'),$.get("http://www.shihuo.cn/haitao/getRegionByRegionId?region_id="+c,function(a){b.cityAddstr(a,$(".select_city").find(".sel-2"))},"json")}),a.find(".sel-2").change(function(a){var c=$(this).val();$.get("http://www.shihuo.cn/haitao/getRegionByRegionId?region_id="+c,function(a){b.cityAddstr(a,$(".select_city").find(".sel-3"))},"json")})},cityAddstr:function(a,b){for(var c=[],d=0,e=a.data.length;e>d;d++)c.push('<option value="'+a.data[d].region_id+'">'+a.data[d].region_name+"</option>"),c.join("");b.html('<option value="0">\u8bf7\u9009\u62e9</option>'+c)},remark:function(){$("#textatea-shuoming").focus(function(){$(this).val()==$(this).attr("data")&&$(this).val("")}),$("#textatea-shuoming").blur(function(){$(this).val()==$(this).attr("data")||""==$.trim($(this).val())?($(this).val($(this).attr("data")),priceValue.remark=""):priceValue.remark=$(this).val()})},express:function(){$("input[name='kuaidi']").change(function(){priceValue.type=1*$("input[name='kuaidi']:checked").val(),getPrice.getJson()})}},priceValue={productId:productId,goodsId:goodsId,address_id:1*$("input[name='address']:checked").val(),type:1*$("input[name='kuaidi']:checked").val(),order_number:$("input[name='order_number']").val(),number:num,from:from,coupon_id:"",remark:""},getPrice={init:function(){},getJson:function(a){$(".submit-btn");$.post("http://www.shihuo.cn/haitao/getOrderTotalPrice",{productId:priceValue.productId,goodsId:priceValue.goodsId,address_id:priceValue.address_id,type:priceValue.type,number:priceValue.number,from:priceValue.from,remark:priceValue.remark,attr:priceValue.attr},function(b){$("#change1").html(b.data.fee),$("#all").html(b.data.total_price),!!a&&a(b)},"json")}},submit={ajaxLoding:!1,init:function(){this.bindFun()},bindFun:function(){var a=this;return a.ajaxLoding?!1:(a.ajaxLoding=!0,void $(".submit-btn").click(function(){var b=$(this);return b.hasClass("submit-btnCC")?!1:(b.addClass("submit-btnCC"),void $.post("http://www.shihuo.cn/haitao/submitOrder",{productId:priceValue.productId,goodsId:priceValue.goodsId,address_id:priceValue.address_id,type:priceValue.type,number:priceValue.number,from:priceValue.from,remark:priceValue.remark,order_number:priceValue.order_number,coupon_id:priceValue.coupon_id},function(c){0==c.status?window.location.href=c.data.url:1*c.status==2?(myCardLayer.init(),b.removeClass("submit-btnCC")):(b.removeClass("submit-btnCC"),b.tipsFun(c.msg)),a.ajaxLoding=!1},"json"))}))}};!function(a){function b(b,c){return this.each(function(){var d=a(this),e='<div class="tips_layer" style="position: absolute; border-radius:5px; background-color:#ff6600; display:none; z-index:995">                <div class="tips-text" style="padding:2px 5px; line-height:18px; color:#fff;">'+b+'</div>                <div class="diamond"></div>            </div>';a(".tips_layer")&&a(".tips_layer").remove(),a(e).appendTo("body");var f=(a(".tips-text"),a(".tips_layer"));c?f.css({top:c.top,left:c.left}).show():f.css({top:d.offset().top-parseInt(d.height())-10,left:d.offset().left+parseInt(d.width()/2)-30}).show(),setTimeout(function(){f.remove()},2e3)})}function c(b){var c=a(this);return this.each(function(){var d='<div class="tips-base-layer" style="position: absolute; padding:5px 7px 7px 7px; font-size:14px; color:#fff; border-radius:5px; background-color:#000; opacity:0.8; display:none; z-index:995"><img style="position: relative; top:-1px;" src="/images/trade/haitao/oder-in.png" /> '+b+'<div style="position: absolute; right:60px; top:32px;"><img src="/images/trade/haitao/oder-in2.png" /></div></div>';a(".tips-base-layer")&&a(".tips-base-layer").remove(),a(d).appendTo("body"),a(".tips-base-layer").css({top:c.offset().top-parseInt(a(".tips-base-layer").height())-20,left:c.offset().left-parseInt(a(".tips-base-layer").width())+c.width()}).show(),setTimeout(function(){a(".tips-base-layer").remove()},2e3)})}a.Jui=a.Jui||{},a.extend(a.Jui,{_$:function(a,b){a.siblings().removeClass(b),a.addClass(b)},_showMasks:function(b){var c="<div class='body-mask' style='position:absolute; top:0; left:0; width:100%; height:"+a(document).height()+"px; background-color:#000;  z-index:91;'></div>";a("body").append(c),a(".body-mask").css("opacity",0),a(".body-mask").animate({opacity:b?b:"0.8"})},_closeMasks:function(){var b=a(".body-mask");b.fadeOut(function(){b.remove()})},_getpageSize:function(){var a,b=document.documentElement,c=window.innerWidth||self.innerWidth||b&&b.clientWidth||document.body.clientWidth,d=window.innerHeight||self.innerHeight||b&&b.clientHeight||document.body.clientHeight;return a=[c,d]},_position:function(b){var c=(this._getpageSize()[0]-parseInt(b.outerWidth()))/2,d=(this._getpageSize()[1]-parseInt(b.outerHeight()))/2+a.Jui._getpageScroll();return[c,d]},_getpageScroll:function(){var a;return self.pageYOffset?a=self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?a=document.documentElement.scrollTop:document.body&&(a=document.body.scrollTop),a},isie:!!a.browser.msie,isie6:!!a.browser.msie&&parseInt(a.browser.version)<=6,DOC:a(document),WIN:a(window),HEAD:a(document).find("head"),BODY:a(document).find("body")}),a.fn.tips=b,a.fn.tipsFun=c}(jQuery);