/** 
 * @Description: shihuo 
 * @author: lanyang 
 * @Update: 2015-11-19 22:11 
 */ 
$(function(){submit.init(),lodingData.init(),sendSec.init()});var sendSec={checksend:!1,init:function(){this.bindFun()},bindFun:function(){var a=/^1[34578][0-9]{9}$/,b=this;$(".Security-btn.send").click(function(){var c=$(".usersphone").val();a.test(c)?b.checksend?$(".usersphone").tips("\u5df2\u53d1\u9001\u9a8c\u8bc1\u7801,\u8bf7\u7a0d\u540e\u70b9\u51fb\u91cd\u53d1",{left:$(this).offset().left+$(this).outerWidth()+10,top:$(this).offset().top}):($(".Security-info").hide(),$(this).removeClass("show"),$(".Security-btn.reset").addClass("show loading"),priceValue.usersphone="",$.post("http://www.shihuo.cn/api/getPassportIdentifyingCode",{mobile:c},function(a){1==a.status?$(".usersphone").tips(a.status,{left:$(this).offset().left+$(this).outerWidth()+10,top:$(this).offset().top}):($(".Security-info").show(),b.checksend=!0,b.countdown(),priceValue.usersphone=c)})):$(".usersphone").tips("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u624b\u673a\u53f7\u7801",{left:$(this).offset().left+$(this).outerWidth()+10,top:$(this).offset().top})})},countdown:function(){var a=60,b=this;$(".Security-btn.reset").removeClass("loading");var c=setInterval(function(){0==a&&(clearInterval(c),b.checksend=!1,$(".Security-btn.reset").removeClass("show"),$("#countdown").text(60),$(".Security-btn.send").addClass("show"),a=60),a--,$("#countdown").text(a)},1e3)}},lodingData={init:function(){1*updateFlag==1&&($.Jui._showMasks(.8),$("#loding-box").css({left:$.Jui._position($("#loding-box"))[0],top:$.Jui._position($("#loding-box"))[1]}).show(),this.postJson())},postJson:function(){$.post("http://www.shihuo.cn/haitao/updateProductInfo",{productId:productId,goodsId:goodsId},function(a){1*a.status==0?$("#up-data").submit():($.Jui._closeMasks(),$("#loding-box").hide())},"json")}},priceValue={productId:productId,goodsId:goodsId,address_id:1*$("input[name='address']:checked").val(),type:1*$("input[name='kuaidi']:checked").val(),order_number:$("input[name='order_number']").val(),number:num,from:from,coupon_id:"",remark:"",usersphone:""},submit={Verification:{name:!1,card:!1,phone:!1,tell:!1,detailed:!1,postal:!1},ajaxLoding:!1,hasLogin:!1,init:function(){this.bindFun(),this.addClassFun(),this.cityAdd(),this.remark()},bindFun:function(){var a=this;return a.ajaxLoding?!1:(a.ajaxLoding=!0,void $(".submit-btn").click(function(){var b=$(this),c=$(".SecurityCode").val();if(b.hasClass("submit-btnCC"))return!1;if(b.addClass("submit-btnCC"),a.hasLogin)a.addressSaveHandle(b);else{if(""==$(".SecurityCode").val())return b.tipsFun("\u8bf7\u586b\u5199\u9a8c\u8bc1\u7801"),b.removeClass("submit-btnCC"),!1;$.post("http://www.shihuo.cn/api/getPassportUserInfo",{mobile:priceValue.usersphone,authcode:c},function(c){var d=$.parseJSON(c);1==d.status?(b.tipsFun(d.msg),b.removeClass("submit-btnCC")):(a.hasLogin=!0,a.addressSaveHandle(b,!0))})}}))},addressSaveHandle:function(a,b){var c=this,d=$(a),e=$("input[name='name']").val(),f=$("input[name='card']").val(),g=$("input[name='phone']").val(),h=$("input[name='phonesection']").val(),i=$("input[name='phonecode']").val(),j=$("input[name='phoneext']").val(),k=$(".sel-1").val(),l=$(".sel-2").val(),m=$(".sel-3").val(),n=$("input[name='detailed']").val(),o=$("input[name='postal']").val();return"checked"==$("input[name='defaultflag']").attr("checked")?defaultflagVal=1:defaultflagVal=0,c.Verification.name?c.Verification.card?c.Verification.phone?""==$.trim($("input[name='phonesection']").val())||""==$.trim($("input[name='phonecode']").val())||""==$.trim($("input[name='phoneext']").val())||c.Verification.tell?c.Verification.detailed?c.Verification.postal?void $.get("http://www.shihuo.cn/haitao/saveDeliveryAddress",{name:e,mobile:g,phonesection:h,phonecode:i,phoneext:j,province:k,city:l,area:m,street:n,postcode:o,defaultflag:defaultflagVal,identity_number:f},function(a){1*a.status==1?(d.tipsFun(a.msg),d.removeClass("submit-btnCC")):(priceValue.address_id=a.data.id,c.payHandle(d))},"json"):(d.tipsFun("\u8bf7\u586b\u5199\u90ae\u653f\u7f16\u7801"),d.removeClass("submit-btnCC"),!1):(d.tipsFun("\u8bf7\u586b\u5199\u8be6\u7ec6\u5730\u5740"),d.removeClass("submit-btnCC"),!1):(d.tipsFun("\u8bf7\u6b63\u786e\u586b\u5199\u7535\u8bdd\u53f7\u7801"),d.removeClass("submit-btnCC"),!1):($(".submit-btn").tipsFun("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u624b\u673a\u53f7\u7801"),d.removeClass("submit-btnCC"),!1):($(".submit-btn").tipsFun("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u8eab\u4efd\u8bc1"),d.removeClass("submit-btnCC"),!1):($(".submit-btn").tipsFun("\u8bf7\u586b\u5199\u59d3\u540d"),d.removeClass("submit-btnCC"),!1)},payHandle:function(a){var b=this,c=$(a);({productId:priceValue.productId,goodsId:priceValue.goodsId,address_id:priceValue.address_id,type:priceValue.type,number:priceValue.number,from:priceValue.from,remark:priceValue.remark,order_number:priceValue.order_number,coupon_id:priceValue.coupon_id});$.post("http://www.shihuo.cn/haitao/submitOrder",{productId:priceValue.productId,goodsId:priceValue.goodsId,address_id:priceValue.address_id,type:priceValue.type,number:priceValue.number,from:priceValue.from,remark:priceValue.remark,order_number:priceValue.order_number,coupon_id:priceValue.coupon_id,mobile:priceValue.usersphone},function(a){0==a.status?window.location.href=a.data.url:1*a.status==2?c.removeClass("submit-btnCC"):(c.removeClass("submit-btnCC"),c.tipsFun(a.msg)),b.ajaxLoding=!1},"json")},checkErrinfo:function(){},addClassFun:function(){function a(){var a=$("input[name='phonesection']").data("check"),b=$("input[name='phonecode']").data("check"),c=$("input[name='phoneext']").data("check");a&&b?0==c?f.Verification.tell=!1:f.Verification.tell=!0:f.Verification.tell=!1}var b=/^1[34578][0-9]{9}$/,c=/^[0-9]{3,6}$/,d=/^[0-9]{5,10}$/,e=/^[0-9]{0,5}$/,f=this;$(".checkhaitao").click(function(){var a=$(this).attr("checked");"checked"!=a?$(".submit-btn").addClass("submit-btnCC"):$(".submit-btn").removeClass("submit-btnCC")}),$("input[name='name']").blur(function(){var a=$(this).val();""==$.trim(a)?f.insertError("\u8bf7\u586b\u5199\u59d3\u540d",this):f.Verification.name=!0}),$("input[name='card']").blur(function(){var a=$(this).val(),b=/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;b.test(a)===!1?f.insertError("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u8eab\u4efd\u8bc1",this):f.Verification.card=!0}),$("input[name='phone']").blur(function(){var a=$(this).val();b.test(a)?f.Verification.phone=!0:f.insertError("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u624b\u673a\u53f7\u7801",this)}),$("input[name='phonesection']").blur(function(){var b=$(this).val();c.test(b)||""==$.trim(b)?$(this).data("check",!0):(f.insertError("\u533a\u53f7\u5fc5\u987b\u4e3a3\u52306\u4f4d\u6570\u5b57",this),$(this).data("check",!1)),a()}),$("input[name='phonecode']").blur(function(){var b=$(this).val();d.test(b)||""==$.trim(b)?$(this).data("check",!0):(f.insertError("\u7535\u8bdd\u5fc5\u987b\u4e3a5\u523010\u4f4d\u6570\u5b57",this),$(this).data("check",!1)),a()}),$("input[name='phoneext']").blur(function(){var b=$(this).val();e.test(b)||""==$.trim(b)?$(this).data("check",!0):(f.insertError("\u7535\u8bdd\u5206\u673a\u5fc5\u987b\u5c11\u4e8e6\u4e2a\u6570\u5b57",this),$(this).data("check",!1)),a()}),$("input[name='detailed']").blur(function(){var a=$(this).val();""==$.trim(a)?f.insertError("\u8bf7\u586b\u5199\u8be6\u7ec6\u5730\u5740",this):f.Verification.detailed=!0}),$("input[name='postal']").blur(function(){var a=$(this).val();""==$.trim(a)?f.insertError("\u8bf7\u586b\u5199\u90ae\u653f\u7f16\u7801",this):f.Verification.postal=!0})},insertError:function(a,b){$(window).scrollTop()>$(b).offset().top?$(".submit-btn").tips(a,{left:$(".submit-btn").offset().left,top:$(".submit-btn").offset().top-40}):$(b).tips(a,{left:$(b).offset().left+$(b).outerWidth()+10,top:$(b).offset().top}),$(".submit-btn").removeClass("submit-btnCC")},clearAddress:function(){$("input[name='name']").val(""),$("input[name='phone']").val(""),$("input[name='phonesection']").val(""),$("input[name='phonecode']").val(""),$("input[name='phoneext']").val(""),$("input[name='detailed']").val(""),$("input[name='postal']").val(""),$("input[name='defaultflag']").removeAttr("checked")},cityAdd:function(){var a=$(".select_city"),b=this;a.find(".sel-1").change(function(a){var c=$(this).val();$(".select_city").find(".sel-2").html('<option value="0">\u8bf7\u9009\u62e9</option>'),$(".select_city").find(".sel-3").html('<option value="0">\u8bf7\u9009\u62e9</option>'),$.get("http://www.shihuo.cn/haitao/getRegionByRegionId?region_id="+c,function(a){b.cityAddstr(a,$(".select_city").find(".sel-2"))},"json")}),a.find(".sel-2").change(function(a){var c=$(this).val();$.get("http://www.shihuo.cn/haitao/getRegionByRegionId?region_id="+c,function(a){b.cityAddstr(a,$(".select_city").find(".sel-3"))},"json")})},cityAddstr:function(a,b){for(var c=[],d=0,e=a.data.length;e>d;d++)c.push('<option value="'+a.data[d].region_id+'">'+a.data[d].region_name+"</option>"),c.join("");b.html('<option value="0">\u8bf7\u9009\u62e9</option>'+c)},remark:function(){$("#textatea-shuoming").focus(function(){$(this).val()==$(this).attr("data")&&$(this).val("")}),$("#textatea-shuoming").blur(function(){$(this).val()==$(this).attr("data")||""==$.trim($(this).val())?($(this).val($(this).attr("data")),priceValue.remark=""):priceValue.remark=$(this).val()})}};!function(a){function b(b,c){return this.each(function(){var d=a(this),e='<div class="tips_layer" style="position: absolute; background-color:#fff9f9;border:1px solid #ffccce;display:none; z-index:995">                <div class="tips-text" style="padding:0px 5px; line-height:30px; color:#e4393c;">'+b+'</div>                <div class="diamond"></div>            </div>';a(".tips_layer")&&a(".tips_layer").remove(),a(e).appendTo("body");var f=(a(".tips-text"),a(".tips_layer"));c?f.css({top:c.top+4,left:c.left}).show():f.css({top:d.offset().top-parseInt(d.height())-10,left:d.offset().left+parseInt(d.width()/2)-30}).show(),setTimeout(function(){f.remove()},2e3)})}function c(b){var c=a(this);return this.each(function(){var d='<div class="tips-base-layer" style="position: absolute; padding:5px 7px 7px 7px; font-size:14px; color:#fff; border-radius:5px; background-color:#000; opacity:0.8; display:none; z-index:995"><img style="position: relative; top:-1px;" src="/images/trade/haitao/oder-in.png" /> '+b+'<div style="position: absolute; right:60px; top:32px;"><img src="/images/trade/haitao/oder-in2.png" /></div></div>';a(".tips-base-layer")&&a(".tips-base-layer").remove(),a(d).appendTo("body"),a(".tips-base-layer").css({top:c.offset().top-parseInt(a(".tips-base-layer").height())-20,left:c.offset().left-parseInt(a(".tips-base-layer").width())+c.width()}).show(),setTimeout(function(){a(".tips-base-layer").remove()},2e3)})}a.Jui=a.Jui||{},a.extend(a.Jui,{_$:function(a,b){a.siblings().removeClass(b),a.addClass(b)},_showMasks:function(b){var c="<div class='body-mask' style='position:absolute; top:0; left:0; width:100%; height:"+a(document).height()+"px; background-color:#000;  z-index:91;'></div>";a("body").append(c),a(".body-mask").css("opacity",0),a(".body-mask").animate({opacity:b?b:"0.8"})},_closeMasks:function(){var b=a(".body-mask");b.fadeOut(function(){b.remove()})},_getpageSize:function(){var a,b=document.documentElement,c=window.innerWidth||self.innerWidth||b&&b.clientWidth||document.body.clientWidth,d=window.innerHeight||self.innerHeight||b&&b.clientHeight||document.body.clientHeight;return a=[c,d]},_position:function(b){var c=(this._getpageSize()[0]-parseInt(b.outerWidth()))/2,d=(this._getpageSize()[1]-parseInt(b.outerHeight()))/2+a.Jui._getpageScroll();return[c,d]},_getpageScroll:function(){var a;return self.pageYOffset?a=self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?a=document.documentElement.scrollTop:document.body&&(a=document.body.scrollTop),a},isie:!!a.browser.msie,isie6:!!a.browser.msie&&parseInt(a.browser.version)<=6,DOC:a(document),WIN:a(window),HEAD:a(document).find("head"),BODY:a(document).find("body")}),a.fn.tips=b,a.fn.tipsFun=c}(jQuery);