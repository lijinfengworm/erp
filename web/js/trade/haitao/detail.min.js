/** 
 * @Description: shihuo 
 * @author: lanyang 
 * @Update: 2016-01-25 11:01 
 */ 
$(function(){function a(){$(window).scrollTop()>$("#offset_post_2").offset().top-$(window).height()&&!commentList.ajaxBefor&&(commentList.init(),commentList.ajaxBefor=!0),$(window).scrollTop()>$("#offset_post_1").offset().top-60?($(".change-title li").removeClass("on"),$(".change-title li").eq(1).addClass("on"),$(window).scrollTop()>$("#offset_post_2").offset().top-60&&($(".change-title li").removeClass("on"),$(".change-title li").eq(2).addClass("on"),$(window).scrollTop()>$("#offset_post_3").offset().top-60&&($(".change-title li").removeClass("on"),$(".change-title li").eq(3).addClass("on")))):($(".change-title li").removeClass("on"),$(".change-title li").eq(0).addClass("on"))}$(".change-title").find("li").click(function(){if($(this).hasClass("cart-area"))return!1;var a=$(this).index();$(window).scrollTop($("#offset_post_"+a).offset().top-50)}),"comment"==commentClick&&$(".change-title li").eq(2).click(),a(),$(window).scroll(function(){a()}),$(".comment-num").click(function(){$(".change-title li:eq(1)").trigger("click"),$(window).scrollTop($(".goods-msg").offset().top)});var b=new tinyScroll;$(".sizebox").each(function(a){var c=$(this);c.find("li").click(function(){var d=$(this).index();c.find("li").attr("class",""),$(this).attr("class","on"),c.find(".switch-size").hide(),c.find(".switch-size").eq(d).show(),b.initScroll(),positionSizebox.sizeboxResize(a,d)})}),updateGoods.init(),collect.init(),goodsInfo.init(),picChange.init(),positionSizebox.init(),shaiwuComment.init(),cart.init("#buy_cart"),cart.init("#fixed_buy_cart"),suspension.init(),popup.init(),promotionalInfo.init()});var positionSizebox={defaults:{ele:".size-content",ele1:".switch-content"},init:function(){this.bindFun()},tinyScroll:function(){return new tinyScroll},bindFun:function(){var a=this;a.doresize(),$(window).resize(function(){a.doresize(),a.tinyScroll().resizeHandle()})},doresize:function(){var a=this,b=$(window).height(),c=$(a.defaults.ele).height()+20;if(b>c){var d=Math.round((b-c)/2);$(a.defaults.ele).css("margin-top",d+"px")}else $(a.defaults.ele).css("margin-top","10px"),a.tinyScroll().root(),a.tinyScroll().initScroll();a.sizeboxResize()},sizeboxResize:function(a,b){var c=this,d=$(c.defaults.ele1).width(),e=void 0===a?1:a;s=void 0===b?0:b;var f=$(c.defaults.ele1).eq(e).find(".switch-size:eq("+s+")").find("table").width();f>d?$(c.defaults.ele1).css("overflow-x","scroll"):$(c.defaults.ele1).css("overflow-x","hidden")}},tinyScroll=function(){var a=this,b=0;a.s_obj=$(".switch-content",".size-content"),a.s_name="s-viewport",a.s_objclass="s-scroll";var c='<div class="scrollbar" style="position:absolute;right:10px;top:0px;width:10px;background-color:#FFF;">';c+='<div class="track">',c+='<div class="thumb" style="width:10px;height20px;background-color:#000;position:absolute;z-index:10;"></div>',c+='<i style="width:1px;height:100%;background-color:#b7b7b7;left:5px;top:0px;position:absolute;z-index:5px;"></i>',c+="</div>",c+="</div>",a.root=function(){0==$("."+a.s_objclass).length&&(a.s_obj.wrap("<div id="+a.s_name+' class="viewport '+a.s_name+'" style="width:100%;height:100%;position:relative;"></div>'),$("."+a.s_name).wrap("<div class="+a.s_objclass+' style="overflow:hidden;width:100%;position:relative;"></div>'),$("."+a.s_objclass).append(c),a.s_obj.addClass("overview"))},a.resizeHandle=function(){var c=$(window).height(),d=160,e=c-d;a.s_obj.height()>e?($("."+a.s_objclass).css("height",e+"px"),$(".scrollbar","."+a.s_objclass).show(),b=1):($("."+a.s_objclass).css("height","auto"),$(".scrollbar","."+a.s_objclass).hide(),b=0)},a.initScroll=function(){a.resizeHandle();var c=$("."+a.s_objclass);c.length>0&&1==b&&(jQuery.browser.msie&&6==jQuery.browser.version?($(".scrollbar","."+a.s_objclass).remove(),a.s_obj.css({position:"static"}),$(".t.s_name","."+a.s_objclass).css({overflowY:"scroll"})):($(".t.s_name","."+a.s_objclass).css("overflow","hidden"),$(".search-result",".search-content").css("padding-bottom","15px"),c.tinyscrollbar()))}},promotionalInfo={defaults:{list:".activity-info ul",more:".more-activity",wrap:".activity-wrap",slidewrap:".slidewrap"},init:function(){var a=this,b=$(a.defaults.list).children().length;b>1?($(a.defaults.wrap).css("height","21px"),b>2&&($(a.defaults.more).show(),a.bindFun())):($(a.defaults.wrap).css("height","23px"),$(a.defaults.more).hide())},bindFun:function(){var a=this;$(a.defaults.slidewrap).hover(function(b){23*$(a.defaults.list).children().length;$(a.defaults.more).addClass("expand"),$(a.defaults.wrap).css({overflow:"visible"}),$(a.defaults.slidewrap).css({border:"1px solid #e5e5e5"})},function(){$(a.defaults.more).removeClass("expand"),$(a.defaults.wrap).css({overflow:"hidden"}),$(a.defaults.slidewrap).css({border:"1px solid #FFFFFF"})})}},updateGoods={defaults:{updateURL:"http://www.shihuo.cn/haitao/updateProductInfo/productId/"+product_id,updateImg:".updateImg",submit:"input[name=submit]",buycart:"#buy_cart,#fixed_buy_cart",cart_unavailable:".cart-unavailable"},init:function(){this.checkGoods()},checkGoods:function(){var a=this,b=$(a.defaults.submit).attr("is-update-goods");1!=b?a.available():a.update()},available:function(){var a=this;$(a.defaults.submit).show(),$(a.defaults.updateImg).hide(),$(a.defaults.buycart).css("display","inline-block"),$(a.defaults.cart_unavailable).hide()},unavailable:function(){var a=this;$(a.defaults.submit).hide(),$(a.defaults.updateImg).show(),$(a.defaults.buycart).hide(),$(a.defaults.cart_unavailable).show()},update:function(){var a=this;$.getJSON(a.defaults.updateURL,function(b){if(0==b.status)$(a.defaults.submit).attr("is-update-goods","0"),a.available();else if(1==b.status){$(a.defaults.submit).attr("is-update-goods","1"),a.unavailable();var c=$(a.defaults.updateImg).find("img").attr("src").replace("btn4.gif","btn5.jpg");$(a.defaults.updateImg).find("img").attr("src",c)}})}},collect={defaults:{btn:".collect",url:"http://www.shihuo.cn/api/collection/id/ID/type/daigou"},init:function(){this.checkCollect(),this.bindFun()},bindFun:function(){var a=this;$(a.defaults.btn).click(function(){return 1==$(a.defaults.btn).attr("is_collect")?($(a.defaults.btn).tips("\u5df2\u6536\u85cf",{left:$(a.defaults.btn).offset().left+0,top:$(a.defaults.btn).offset().top+30}),!1):void $.getJSON("http://www.shihuo.cn/api/collection/id/"+product_id+"/type/daigou",function(b){if(0==b.status)commonLogin("hupu");else if(1==b.status){$(a.defaults.btn).attr("is_collect","1");var c=Math.round($(a.defaults.btn).find("span").text())+1;$(a.defaults.btn).find("span").text(c),a.checkCollect()}else 2==b.status&&$(a.defaults.btn).tips("\u5df2\u6536\u85cf",{left:$(a.defaults.btn).offset().left+0,top:$(a.defaults.btn).offset().top+30})})})},checkCollect:function(){var a=this,b=$(a.defaults.btn).attr("is_collect");1==b?$(a.defaults.btn).removeClass("unselect").addClass("oncollect"):$(a.defaults.btn).removeClass("oncollect").addClass("unselect")}},popup={defaults:{popupObj:".popup-wrap",popupBtn:".size-chart"},init:function(){this.showPopup(),this.bindFun()},bindFun:function(){var a=this,b=$(a.defaults.popupObj);b.find(".bg").click(function(){b.css({left:"100%",visibility:"hidden"})}),b.find(".closebtn").click(function(){b.css({left:"100%",visibility:"hidden"})})},showPopup:function(){var a=this,b=$(a.defaults.popupBtn);b.click(function(){$(a.defaults.popupObj).css({left:"0px",visibility:"visible"})})}},suspension={defaults:{suspensioner:".change-title",fixed:".goods-msg",buyarea:".buy-area"},init:function(){var a=this;a.bindFun(),$(window).scroll(function(){a.bindFun()})},bindFun:function(){var a=this;st=$(window).scrollTop(),sh=$(a.defaults.suspensioner).height(),ct=$(a.defaults.buyarea).offset().top+$(a.defaults.buyarea).height(),ft=$(a.defaults.fixed).offset().top,st>ft?$(a.defaults.suspensioner).css({position:"fixed",top:"0px"}):$(a.defaults.suspensioner).css({position:"relative"}),st>ct?$(a.defaults.suspensioner).find(".cart-area").stop(!0,!0).fadeIn():$(a.defaults.suspensioner).find(".cart-area").stop(!0,!0).fadeOut()}},goodsInfo={init:function(){this.bindFun()},bindFun:function(){var a=$("#goods_num");a.find(".n1").click(function(){var b=1*a.find(".num_value").val();!$(this).hasClass("false")&&b>1&&(b--,a.find(".n2").html(b),a.find(".num_value").val(b),1==b&&$(this).addClass("false"),b<limit&&a.find(".n3").removeClass("false"))}),a.find(".n3").click(function(){var b=1*a.find(".num_value").val();!$(this).hasClass("false")&&b<limit&&(b++,a.find(".n2").html(b),a.find(".num_value").val(b),b==limit&&$(this).addClass("false"),b>1&&a.find(".n1").removeClass("false"))}),$("#zan").click(function(){var a=$(this);1*loginflag==1?$.getJSON("http://www.shihuo.cn/haitao/saveHaitaoDaigouPraise?product_id="+product_id,{},function(b){1*b.status==0&&(a.find(".tag").html('<i class="ic ic-head on"></i>\u5df2\u8d5e'),a.find("s").html(b.data.num),a.attr("id","")),1*b.status==1&&commonLogin("hupu"),1*b.status==4&&a.attr("id","")},"json"):commonLogin("hupu")})}},picChange={allImg:!1,init:function(){this.bindFun()},bindFun:function(){var a=$("#img_list"),b=$("#img_array"),c=$("#num_1");$("#click_1"),$("#click_2");a.find(".img").click(function(){var a=$(this).index();$(this).addClass("on").siblings().removeClass("on"),b.find("img").hide(),b.find("img").eq(a).show(),c.find("s").html(a+1)})}},positionTitle={allNum:$(".title_js_box").length,list:0,init:function(){var a=parseInt($(".goods-msg").find(".area-main .goods-present").outerHeight());return $.browser.msie&&parseInt($.browser.version)<=6||2e3>a?!1:void this.bindFun()},bindFun:function(){var a=$(".base-title"),b=$(".title_js_box"),c=this;$(window).scroll(function(d){$(this).scrollTop()>b.eq(c.list).offset().top&&(a.eq(c.list).css({left:b.eq(c.list).offset().left-50,top:53*c.list,zIndex:1}).addClass("post_js_tit"),c.list++),c.list-1>=0&&$(this).scrollTop()<b.eq(c.list-1).offset().top&&(a.eq(c.list-1).css({left:-50,top:0,zIndex:0}).removeClass("post_js_tit"),c.list--)}),$(".post_js_tit").live("click",function(){var a=$(this).parent(".title_js_box").offset().top-30;$("html, body").animate({scrollTop:a},500)})}},commentList={defaults:{pages:1,is_img:0},ajaxBefor:!1,ajaxLoding:!1,init:function(){this.getAjax(),this.bindClick()},getAjax:function(){var a=this;return a.ajaxLoding?!1:(a.ajaxLoding=!0,void $.post("http://www.shihuo.cn/haitao/ajaxComment",{page:this.defaults.pages,is_img:this.defaults.is_img,product_id:product_id},function(b){b.status?(a.allPage=b.msg.num,a.writePage(),a.writrTxt(b.msg.res),$(".none-comment").hide()):($(".none-comment").show(),$(".comment-list,.comment-pages").hide()),a.ajaxLoding=!1},"json"))},writrTxt:function(a){for(var b,c,d=[],e="",f="",g="",h=0;h<a.length;h++){for(b in a[h].tags_attr)e+="<span>"+a[h].tags_attr[b]+"</span>";for(c in a[h].imgs)g+='<div class="imgs">                           <img src="'+a[h].imgs[c]+'?imageView2/1/w/50" / data_src="'+a[h].imgs[c]+'">                       </div>';for(z in a[h].attr)f+="&nbsp;&nbsp;&nbsp;&nbsp;"+z+" : "+a[h].attr[z];d.push('<li class="clearfix">                      <div class="comment-main">                          <img src="'+a[h].user_head+'" />                          <p>'+a[h].user_name+'</p>                      </div>                      <div class="comment-sub">                          <div class="tips-area">'+e+'</div>                          <div class="txt">'+a[h].content+'</div>                          <div class="pic clearfix">'+g+'</div>                          <div class="picBig"></div>                          <div class="date">'+a[h].created_at+f+"</div>                      </div>                 </li>"),e="",f="",g=""}$(".comment-list").html(d.join("")).show()},writePage:function(){var a=this.allPage,b='<a class="pre" href="#comment">&lt; \u4e0a\u4e00\u9875</a>';if(1==a)return $(".comment-pages").hide(),!1;if($(".comment-list,.comment-pages").show(),6>a||this.defaults.pages<6)if(6>a)for(var c=0;a>c;c++)b+='<a class="a1'+(c==this.defaults.pages-1?" on":"")+'" href="#comment">'+(c+1)+"</a>";else for(var c=0;6>c;c++)b+='<a class="a1'+(c==this.defaults.pages-1?" on":"")+'" href="#comment">'+(c+1)+"</a>";else{for(var c=0;2>c;c++)b+='<a class="a1" href="#comment">'+(c+1)+"</a>";b+="<span>...</span>";for(var c=0;4>c&&!(this.defaults.pages-2+c>a);c++)b+='<a class="a1'+(this.defaults.pages==this.defaults.pages-2+c?" on":"")+'" href="#comment">'+(this.defaults.pages-2+c)+"</a>"}b+='<a class="next" href="#comment">\u4e0b\u4e00\u9875 &gt;</a>',$(".comment-pages").html(b),this.defaults.pages>1&&$(".comment-pages .pre").css({cursor:"pointer"}),this.defaults.pages==a&&$(".comment-pages .next").css({cursor:"auto"})},bindClick:function(){var a=this;$(".comment-pages .a1").live("click",function(){var b=$(this).html();a.defaults.pages=b,a.getAjax(),$(window).scrollTop($("#offset_post_2").offset().top)}),$(".comment-pages .pre").live("click",function(){var b=1*a.defaults.pages-1;b>0&&(a.defaults.pages=b,a.getAjax(),$(window).scrollTop($("#offset_post_2").offset().top))}),$(".comment-pages .next").live("click",function(){var b=1*a.defaults.pages+1;b<=a.allPage&&(a.defaults.pages=b,a.getAjax(),$(window).scrollTop($("#offset_post_2").offset().top))}),$("input[name='comPic']").change(function(){a.defaults.is_img=1*$(this).attr("inf"),a.defaults.pages=1,a.getAjax()}),$(".comment-sub").find(".imgs").live("click",function(){var a=$(this).find("img").attr("data_src")+"?imageView2/1/w/350";$(this).parent(".pic").next().html("<img src='"+a+"' />")}),$(".comment-sub").find(".picBig img").live("click",function(){$(this).parent(".picBig").html("")})}},shaiwuComment={ajaxBefor:!1,ajaxLoding:!1,init:function(){this.getAjax(),this.bindClick()},getAjax:function(){var a=this;return a.ajaxLoding?!1:(a.ajaxLoding=!0,void $.post("http://www.shihuo.cn/haitao/ajaxShaiwu",{product_id:product_id},function(b){1*b.status==2?$(".shaiwu-comm-list").next().show():a.writeHtml(b.data)},"json"))},writeHtml:function(a){for(var b="",c=0;c<a.length;c++)b+='<li class="clearfix">                            <div class="t1">                                <img src="http://bbs.hupu.com/bbskcy/api_new_image.php?type=big&uid='+a[c].author_id+'" width="45" />                            </div>                            <div class="t2">                                <div class="name">'+a[c].author_name+" "+(1==a[c].is_star?'<img src="/images/trade/shaiwu/shaiwuindex/rk.jpg" />':"")+'</div>                                <div class="time">'+a[c].publish_time+'</div>                                <div class="h2">'+(1==a[c].is_hot?'<img src="/images/trade/shaiwu/shaiwuindex/boutiqueicon.png" /> ':"")+a[c].activity_name+' <a target="_blank" href="http://www.shihuo.cn/shaiwu/detail/'+a[c].id+'.html">'+a[c].title+'</a></div>                                <div class="img-txt clearfix">                                    <div class="l-img">                                        <img src="'+a[c].front_pic+'" />                                    </div>                                    <div class="r-txt">                                        '+a[c].intro+'<a target="_blank" href="http://www.shihuo.cn/shaiwu/detail/'+a[c].id+'.html">\u67e5\u770b\u8be6\u60c5</a>                                    </div></div>                            </div>                        </li>';$(".shaiwu-comm-list").append(b)},bindClick:function(){}},cart={ajaxLoding:!1,init:function(a){$(a).length>0&&this.bindFun(a)},bindFun:function(a){var b=$(a),c=this;b.click(function(){var d=$("#goods_num").find(".n2").html();return c.ajaxLoding?!1:(c.ajaxLoding=!0,void $.post("http://www.shihuo.cn/haitao/addCart",{product_id:product_id,goods_id:goods_id,number:d,from:from},function(d){if(1*d.status==0&&($("#cart-right-area .goods-num").html(d.data.count),$("#cart_num_nva").html(d.data.count),c.animate(d.data.img_path,a)),1*d.status==1){var e="#fixed_buy_cart"==a?50:-30;b.tips(d.msg,{left:b.offset().left+30,top:b.offset().top+1*e}),c.ajaxLoding=!1}1*d.status==2&&(commonLogin("hupu"),c.ajaxLoding=!1)},"json"))})},animate:function(a,b){var c='<img id="cart-img-box" style="position: absolute; left:'+(1*$(b).offset().left+100)+"px;top:"+$(b).offset().top+'px; width:45px; height:45px;" src="'+a+'" />',d=this;$(c).appendTo("body"),"#fixed_buy_cart"==b?$("#cart-img-box").animate({left:$("#cart-right-area").offset().left,top:$("#cart-right-area").offset().top},500,function(){$("#cart-img-box").remove(),d.ajaxLoding=!1}):$("#cart-img-box").paracurve({end:[$("#cart-right-area").offset().left,$("#cart-right-area").offset().top],step:10,movecb:function(){$("#cart-img-box").animate({width:20,height:20})},moveendcb:function(){$("#cart-img-box").remove(),d.ajaxLoding=!1}})}};!function(a){var b=a.fn.paracurve;a.fn.paracurve=function(b){var c={start:[this.position().left,this.position().top],end:[a(window).width()-this.width(),a(window).height()-this.height()],step:1,movecb:a.noop,moveendcb:a.noop},d=this;a.extend(c,b);var e=c.start[0],f=c.start[1],g=c.end[0],h=c.end[1],i=e+(g-e)/2,j=Math.min(f,h)-100;i=i>0?Math.ceil(i):Math.floor(i),j=0>j?0:Math.ceil(j);var k=i-e,l=j-f,m=i-g,n=j-h,o=(n-l*m/k)/(m*m-k*m),p=(l-o*k*k)/k;return d.each(function(b,e){function f(){a(e).data("running",!1).css({left:g+"px",top:h+"px"}),clearInterval(l),c.moveendcb&&a.isFunction(c.moveendcb)&&c.moveendcb.call(e)}var k=a(e).data("startPos");if(k=k?k:a(e).position(),a(e).data("running")||k.left==g)f(),a(e).css({left:k.left+"px",top:k.top+"px"});else{a(e).data("startPos",a(e).position());var l=setInterval(function(){var b=a(e).position();if(b.left>=g)f();else{var h=b.left+c.step,k=i-h,l=o*k*k+p*k,m=j-l;d.css({left:h+"px",top:m+"px"}),a(e).data("running",!0),c.movecb&&a.isFunction(c.movecb)&&c.movecb.call(e)}},30);a(e).data("timer",l)}})},a.fn.paracurve.noConflict=function(){return a.fn.paracurve=b,this}}(jQuery),!function(a){function b(b,c){return this.each(function(){var d=a(this),e='<div class="tips_layer" style="position: absolute; border-radius:5px; background-color:#ff6600; display:none; z-index:995">                <div class="tips-text" style="padding:2px 5px; line-height:18px; color:#fff;">'+b+'</div>                <div class="diamond"></div>            </div>';a(".tips_layer")&&a(".tips_layer").remove(),a(e).appendTo("body");var f=(a(".tips-text"),a(".tips_layer"));c?f.css({top:c.top,left:c.left}).show():f.css({top:d.offset().top-parseInt(d.height())-10,left:d.offset().left+parseInt(d.width()/2)-30}).show(),setTimeout(function(){f.remove()},2e3)})}a.Jui=a.Jui||{},a.extend(a.Jui,{_$:function(a,b){a.siblings().removeClass(b),a.addClass(b)},_showMasks:function(b){var c="<div class='body-mask' style='position:absolute; top:0; left:0; width:100%; height:"+a(document).height()+"px; background-color:#000;  z-index:91;'></div>";a("body").append(c),a(".body-mask").css("opacity",0),a(".body-mask").animate({opacity:b?b:"0.8"})},_closeMasks:function(){var b=a(".body-mask");b.fadeOut(function(){b.remove()})},_getpageSize:function(){var a,b=document.documentElement,c=window.innerWidth||self.innerWidth||b&&b.clientWidth||document.body.clientWidth,d=window.innerHeight||self.innerHeight||b&&b.clientHeight||document.body.clientHeight;return a=[c,d]},_position:function(b){var c=(this._getpageSize()[0]-parseInt(b.outerWidth()))/2,d=(this._getpageSize()[1]-parseInt(b.outerHeight()))/2+a.Jui._getpageScroll();return[c,d]},_getpageScroll:function(){var a;return self.pageYOffset?a=self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?a=document.documentElement.scrollTop:document.body&&(a=document.body.scrollTop),a},isie:!!a.browser.msie,isie6:!!a.browser.msie&&parseInt(a.browser.version)<=6,DOC:a(document),WIN:a(window),HEAD:a(document).find("head"),BODY:a(document).find("body")}),a.fn.tips=b}(jQuery);