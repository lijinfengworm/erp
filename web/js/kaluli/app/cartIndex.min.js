define("changenum",[],function(){"use strict";function t(t){this.opt=void 0!==t?t:""}var i;return t.prototype={defaults:{wrap:".numbox",subtract:".icon-subtract-nosprite",add:".icon-add--nosprite",textbox:"#numbox-text"},init:function(){var t=this;$.extend(t.defaults,t.opt),t.inputchange(t.callback),t.subtract(t.callback),t.add(t.callback)},inputchange:function(t){var i=this;$(i.defaults.textbox).each(function(){$(this).bind("input propertychange",function(){var e=$(this),a=e.val(),s=$("#stock").length>0?parseInt($("#stock").text()):parseInt($(this).parent().find(".numbox-text").attr("maxstock"));a<=0||"undefined"==typeof a?($(this).siblings(i.defaults.subtract).addClass("nodrop"),$(".error-msg .busnum").addClass("show")):a>s?($(this).siblings(i.defaults.add).addClass("nodrop"),$(".error-msg .busnum").addClass("show"),i.overstock(this)):($(this).siblings(i.defaults.subtract).removeClass("nodrop"),$(this).siblings(i.defaults.add).removeClass("nodrop"),$(".error-msg .busnum").removeClass("show")),t(this)})})},subtract:function(t){var e=this;$(e.defaults.subtract).each(function(){$(this).click(function(){var a=$(this);if(i=a.siblings(e.defaults.textbox).val(),1==i)return a.addClass("nodrop"),!1;a.siblings(e.defaults.add).removeClass("nodrop"),a.removeClass("nodrop"),$(".error-msg .busnum").removeClass("show"),e.roll(a.parent(),i,"down"),i--;var s=Math.round(0+parseInt(i));return a.siblings(e.defaults.textbox).val(s),t(this),!1})})},add:function(t){var e=this;$(e.defaults.add).each(function(){$(this).click(function(){var a=$(this),s=$("#stock").length>0?parseInt($("#stock").text()):parseInt($(this).parent().find(".numbox-text").attr("maxstock"));if(i=a.siblings(e.defaults.textbox).val(),i>=s)return a.addClass("nodrop"),e.overstock(this),!1;a.siblings(e.defaults.subtract).removeClass("nodrop"),a.removeClass("nodrop"),$(".error-msg .busnum").removeClass("show"),e.roll(a.parent(),i,"up"),i++;var o=Math.round(0+parseInt(i));return a.siblings(e.defaults.textbox).val(o),t(this),!1})})},roll:function(t,i,e){var a,s,o,n;if("up"==e)a=parseInt(i)+1,s=-22,o=1,n="vbottom";else{if("down"!=e)return!1;a=parseInt(i)-1,s=27,o=1,n="vtop"}var d='<div class="rollstocknum"><div class="v v1">'+i+'</div><div class="v v2 '+n+'">'+a+"</div></div>";$(t).append(d),$(".rollstocknum").show(),$(".v1").stop().animate({top:s+"px"},150),$(".v2").stop().animate({top:o+"px"},150,function(){$(".rollstocknum").remove()})},callback:function(t){},overstock:function(t){}},t}),define("tips",[],function(){function t(t,i){return this.each(function(){var e=$(this),a='<div class="tips_layer" style="position: absolute; border-radius:5px; background-color:#ff6600; display:none; z-index:995">                    <div class="tips-text" style="padding:2px 5px; line-height:18px; color:#fff;">'+t+'</div>                    <div class="diamond"></div>                </div>';$(".tips_layer")&&$(".tips_layer").remove(),$(a).appendTo("body");var s=($(".tips-text"),$(".tips_layer"));i?s.css({top:i.top,left:i.left}).show():s.css({top:e.offset().top-parseInt(e.height())-10,left:e.offset().left+parseInt(e.width()/2)-30}).show(),setTimeout(function(){s.remove()},2e3)})}function i(t,i){var e=$(this);return this.each(function(){var i='<div class="tips-base-layer" style="position: absolute; padding:5px 7px 7px 7px; font-size:14px; color:#fff; border-radius:5px; background-color:#000; opacity:0.8; display:none; z-index:995"><img style="position: relative; top:-1px;" src="//kaluli.hoopchina.com.cn/images/kaluli/order/oder-in.png" /> '+t+'<div style="position: absolute; right:45%; top:32px;"><img src="//kaluli.hoopchina.com.cn/images/kaluli/order/oder-in2.png" /></div></div>';$(".tips-base-layer")&&$(".tips-base-layer").remove(),$(i).appendTo("body"),$(".tips-base-layer").css({top:e.offset().top-parseInt($(".tips-base-layer").height())-20,left:e.offset().left-(e.width()>$(".tips-base-layer").width()?(e.width()-$(".tips-base-layer").width())/2:($(".tips-base-layer").width()-e.width())/2)}).show(),setTimeout(function(){$(".tips-base-layer").remove()},2e3)})}$.fn.tipsFun=i,function(){$.fn.tips=t,$.Jui=$.Jui||{},$.extend($.Jui,{_$:function(t,i){t.siblings().removeClass(i),t.addClass(i)},_showMasks:function(t){var i="<div class='body-mask' style='position:absolute; top:0; left:0; width:100%; height:"+$(document).height()+"px; background-color:#000;  z-index:101;'></div>";$("body").append(i),$(".body-mask").css("opacity",0),$(".body-mask").animate({opacity:t?t:"0.8"})},_closeMasks:function(){var t=$(".body-mask");t.fadeOut(function(){t.remove()})},_getpageSize:function(){var t,i=document.documentElement,e=window.innerWidth||self.innerWidth||i&&i.clientWidth||document.body.clientWidth,a=window.innerHeight||self.innerHeight||i&&i.clientHeight||document.body.clientHeight;return t=[e,a]},_position:function(t){var i=(this._getpageSize()[0]-parseInt(t.outerWidth()))/2,e=(this._getpageSize()[1]-parseInt(t.outerHeight()))/2+$.Jui._getpageScroll();return[i,e]},_getpageScroll:function(){var t;return self.pageYOffset?t=self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?t=document.documentElement.scrollTop:document.body&&(t=document.body.scrollTop),t},isie:!!$.browser.msie,isie6:!!$.browser.msie&&parseInt($.browser.version)<=6,DOC:$(document),WIN:$(window),HEAD:$(document).find("head"),BODY:$(document).find("body")})}(jQuery)}),define("cartUtil",["tips"],function(){var t={changeFlag:!0,submitUp:!1,goodCheck:[],goodList:[],goodGid:null,init:function(){this.bindFun()},bindFun:function(){var t=this;$(".check_all").change(function(){var i=$(this).attr("checked");"checked"==i?($("input[name='check-all']").attr("checked","checked"),$("input[name='check-goods']").each(function(){$(this).attr("checked","checked")})):($("input[name='check-goods']").attr("checked",!1),$("input[name='check-all']").attr("checked",!1)),t.getGoodsIdPost()}),$(".check_all_nansha").change(function(){var i=$(this).attr("checked");"checked"==i?($("input[name='check-all-nansha']").attr("checked","checked"),$("input[name='check-goods-nansha']").each(function(){$(this).attr("checked","checked")})):($("input[name='check-goods-nansha']").attr("checked",!1),$("input[name='check-all-nansha']").attr("checked",!1)),t.getGoodsIdPost("nansha")}),$("input[name='check-goods']").change(function(){var i=!0;$(this).parents("table").find("input[name='check-goods']").each(function(t,e){e.checked||(i=!1)}),i?$("input[name='check-all']").attr("checked","checked"):$("input[name='check-all']").attr("checked",!1),t.getGoodsIdPost()}),$("input[name='check-goods-nansha']").change(function(){var i=!0;$(this).parents("table").find("input[name='check-goods-nansha']").each(function(t,e){e.checked||(i=!1)}),i?$("input[name='check-all-nansha']").attr("checked","checked"):$("input[name='check-all-nansha']").attr("checked",!1),t.getGoodsIdPost("nansha")}),$("#delete_id").click(function(){t.deleteConfirm(t.goodCheck)}),$("#delete_id_ns").click(function(){t.deleteConfirm(t.nsGoodCheck)}),$(".cartpro_list .delete").click(function(){t.goodGid=$(this).attr("gid"),t.deleteConfirm([t.goodGid])}),$(".write-card i,.write-card .btn2,.body-mask").live("click",function(){$.Jui._closeMasks(),$(".write-card").remove()}),$(".write-card .btn1").live("click",function(){$.Jui._closeMasks(),t.deleteGoods($(".write-card").data("gid")),$(".write-card").remove()}),$("#submit-all").click(function(){return t.goodList.length>0?t.fromSubmit():alert("请勾选商品"),!1}),$("#submit-all-ns").click(function(){return t.nsGoodList.length>0?t.fromSubmit("nansha"):alert("请勾选商品"),!1})},checkAllFun:function(){var t=!1;$("input[name='check-goods']").each(function(i,e){if(!e.checked)return t=!0,!1}),t?$("input[name='check-all']").attr("checked",!1):$("input[name='check-all']").attr("checked","checked")},getGoodsIdPost:function(t){if("nansha"!=t&&"benniao"!=t){var i=this;i.goodCheck=[],i.goodList=[],$("input[name='check-goods']:enabled").each(function(t,e){e.checked&&(i.goodCheck.push(e.getAttribute("gid")),i.goodList.push(e.getAttribute("gilist")))}),$.post("//www.kaluli.com/order/getCartAllPrice",{data:i.goodCheck},function(t){if(1*t.status==0)if($(".price-id-1").html("￥"+t.data.total_product_price),$(".price-id-2").html("￥"+t.data.total_product_freight),$(".price-id-3").html(t.data.total_count),$(".price-id-4").html("￥"+t.data.total_price),$(".price-id-7").html(t.data.total_duty_fee),"undefined"==typeof t.data.original_price?$(".price-id-5").html("￥0"):$(".price-id-5").html("￥"+t.data.original_price),$(".activity-discount").text(0),"undefined"==typeof t.data.activity)$(".price-id-6").html("0"),$(".border-left").removeClass("show"),$(".activity-info span").attr("class",""),$(".go-buy").addClass("noactivity"),$(".goto-prolist").show(),$(".td5 .one-activity").show(),$(".td5 .two-activity").hide();else{$(".price-id-6").html(t.data.activity.activity_save);var i=t.data.activity.goods_info;$(".activity-info span").attr("class",""),$(".goto-prolist").show();for(var e in t.data.activity.activity)t.data.activity.activity[e].activity_save?$(".activity-discount","#discount-"+e).text(t.data.activity.activity[e].activity_save):$(".activity-discount","#discount-"+e).text(0);for(var a in i)for(var s=0;s<i[a].activity.length;s++)i[a].activity[s].flag?($(".activity-info span:eq("+s+")",".goods-id-"+a).attr({class:"on"}),$(".goto-prolist",".goods-id-"+a).eq(s).hide(),$(".goods-id-"+a+" .td5").find(".one-activity").hide(),$(".goods-id-"+a+" .td5").find(".two-activity").show()):($(".goods-id-"+a+" .td5").find(".one-activity").show(),$(".goods-id-"+a+" .td5").find(".two-activity").hide());$(".border-left").addClass("show")}else alert(t.msg)},"json")}else if("nansha"==t){var i=this;i.nsGoodCheck=[],i.nsGoodList=[],$("input[name='check-goods-nansha']:enabled").each(function(t,e){e.checked&&(i.nsGoodCheck.push(e.getAttribute("gid")),i.nsGoodList.push(e.getAttribute("gilist")))}),$.post("//www.kaluli.com/order/getCartAllPrice",{data:i.nsGoodCheck},function(t){if(1*t.status==0)if($(".price-id-1").html("￥"+t.data.total_product_price),$(".price-id-2").html("￥"+t.data.total_product_freight),$(".price-id-3-n").html(t.data.total_count),$(".price-id-4-n").html("￥"+t.data.total_price),$(".price-id-7-n").html(t.data.total_duty_fee),t.data.total_price>=2e3?($("#warning_nansha").show(),$("#submit-all-ns").attr("disabled","disabled"),$("#submit-all-ns").addClass("input-false")):($("#warning_nansha").hide(),$("#submit-all-ns").removeAttr("disabled").removeClass("input-false")),"undefined"==typeof t.data.original_price?$(".price-id-5-n").html("￥0"):$(".price-id-5-n").html("￥"+t.data.original_price),$(".activity-discount").text(0),"undefined"==typeof t.data.activity)$(".price-id-6-n").html("￥0"),$(".border-left").removeClass("show"),$(".activity-info span").attr("class",""),$(".go-buy").addClass("noactivity"),$(".goto-prolist").show(),$(".td5 .one-activity").show(),$(".td5 .two-activity").hide();else{$(".price-id-6-n").html("￥"+t.data.activity.activity_save),$(".ns-activity-discount").html(t.data.activity.activity_save);var i=t.data.activity.goods_info;$(".activity-info span").attr("class",""),$(".goto-prolist").show();for(var e in t.data.activity.activity)t.data.activity.activity[e].activity_save?$(".activity-discount","#discount-"+e).text(t.data.activity.activity[e].activity_save):$(".activity-discount","#discount-"+e).text(0);for(var a in i)for(var s=0;s<i[a].activity.length;s++)i[a].activity[s].flag?($(".activity-info span:eq("+s+")",".goods-id-"+a).attr({class:"on"}),$(".goto-prolist",".goods-id-"+a).eq(s).hide(),$(".goods-id-"+a+" .td5").find(".one-activity").hide(),$(".goods-id-"+a+" .td5").find(".two-activity").show()):($(".goods-id-"+a+" .td5").find(".one-activity").show(),$(".goods-id-"+a+" .td5").find(".two-activity").hide());$(".border-left").addClass("show")}else alert(t.msg)},"json")}},addGoods:function(t,i){var e=this;$.post("//www.kaluli.com/order/addCartNumber",t,function(a){if(1*a.status==0){console.log(a.data);var s="";if(3==a.data.activity_type)if(1==a.data.discount_rate)s="<p>￥"+a.data.total_price.toFixed(2)+'</p><p>进口税预计:<span class="dutyFee">'+a.data.dutyFee+"</span>元</p>";else if(0==a.data.activity_flag)s="<p>￥"+a.data.total_price.toFixed(2)+'</p><p>进口税预计:<span class="dutyFee">'+a.data.dutyFee+"</span>元</p>";else{var o=a.data.total_price*a.data.discount_rate/10;s='<p style="color: #999;font-size: 12px;text-decoration: line-through">¥'+a.data.total_price.toFixed(2)+"</p><p>￥"+o.toFixed(2)+'</p><p>进口税预计:<span class="dutyFee">'+a.data.dutyFee+"</span>元</p>"}else if(2==a.data.activity_type){if(1!=a.data.discount_rate){var o=a.data.total_price*a.data.discount_rate/10;s='<div class="one-activity"><p>￥'+a.data.total_price.toFixed(2)+'</p><p>进口税预计:<span class="dutyFee">'+a.data.dutyFee+'</span>元</p></div><div class="two-activity" style="display: none"><p style="color: #999;font-size: 12px;text-decoration: line-through">¥'+a.data.total_price.toFixed(2)+"</p><p>￥"+o.toFixed(2)+'</p><p>进口税预计:<span class="dutyFee">'+a.data.dutyFee+"</span>元</p>"}}else s="<p>￥"+a.data.total_price.toFixed(2)+'</p><p>进口税预计:<span class="dutyFee">'+a.data.dutyFee+"</span>元</p>";i.html(s),"nansha"==t.isNanSha?e.getGoodsIdPost("nansha"):e.getGoodsIdPost()}},"json")},deleteConfirm:function(t){var i='<div class="write-card">                      <div class="title"><i></i>提示</div>                      <div class="inner">                          <div class="inner-html clearfix">                               <div class="left">                                  <img src="/images/trade/ucenter/gt.jpg" />                               </div>                               <div class="right">                                  <div class="h2">删除商品?</div>                                  <div class="btn-span">                                      <span class="btn1">确定</span><span class="btn2">取消</span>                                  </div>                               </div>                          </div>                      </div>                  </div>';$.Jui._showMasks(.6),$(i).appendTo("body"),$(".write-card").css({left:$.Jui._position($(".write-card"))[0],top:$.Jui._position($(".write-card"))[1]-$.Jui._getpageScroll()}).show(),$(".write-card").data("gid",t)},deleteGoods:function(t){var i=this;$.post("//www.kaluli.com/order/deleteCart",{data:t},function(e){if(1*e.status==0){$(".price-id-3").html(e.data);for(var a=0;a<t.length;a++){$("#cartpro_list tbody");$(".goods-id-"+t[a]).remove(),$("#cartpro_list tbody").find("tr").length<1&&location.reload()}i.getGoodsIdPost(),$(".cart-box .cartnum").html(e.data),window.location.reload()}},"json")},fromSubmit:function(t){if("nansha"!=t&&"benniao"!=t){var i="";if(this.submitUp)return!1;this.submitUp=!0,$("#submit-all").addClass("input-false"),$("#submit-all").val("提交中...");for(var e=0;e<this.goodList.length;e++)i+=(0==e?"":",")+this.goodList[e];$("#goods-form").html('<input type="hidden" value="'+i+'" name="data" />'),$("#goods-form").submit()}else if("nansha"==t){var i="";if(this.submitUp)return!1;this.submitUp=!0,$("#submit-all-ns").addClass("input-false"),$("#submit-all-ns").val("提交中...");for(var e=0;e<this.nsGoodList.length;e++)i+=(0==e?"":",")+this.nsGoodList[e];$("#goods-form-ns").html('<input type="hidden" value="'+i+'" name="data" />'),$("#goods-form-ns").submit()}else if("benniao"==t){if(this.submitUp)return!1;this.submitUp=!0,$("#submit-all-bn").addClass("input-false"),$("#submit-all-bn").val("提交中...");for(var e=0;e<this.bnGoodList.length;e++)i+=(0==e?"":",")+this.bnGoodList[e];i.indexOf("undefined")>=0&&(i=i.replace(/undefined/,"")),$("#goods-form-bn").html('<input type="hidden" value="'+i+'" name="data" />'),$("#goods-form-bn").submit()}}};return t}),requirejs.config({baseUrl:"//kaluli.hoopchina.com.cn/js/kaluli/",paths:{changenum:"modules/product/changenum",cartUtil:"modules/order/cartUtil",tips:"modules/common/tips"},urlArgs:"v="+("undefined"!=typeof GV?GV.VERSION:(new Date).getTime())}),require(["changenum","cartUtil"],function(t,i){var e=new t;e.callback=function(t){var e,a=$(t).parent().attr("gid"),s=$(t).attr("class"),o=parseInt($(t).parent().find("input").val()),n=parseInt($(t).parent().find("input").attr("maxstock")),d=$(t).attr("attr");o<=n&&$(t).parent().siblings(".maxnumtips").remove(),"icon-subtract-nosprite"==s?e=0:"icon-add--nosprite"==s&&(e=1),i.addGoods({sku_id:a,type:e,isNanSha:d},$(t).parents(".td4").next())},e.overstock=function(t){if($(t).parent().siblings(".maxnumtips").length>0)return!1;var i=parseInt($(t).parent().find("input").attr("maxstock")),e='<div class="maxnumtips" style="width:140px;margin:10px auto 0;border-radius:5px; background-color:#ff6600; display:block; z-index:995">                        <div class="tips-text" style="padding:2px 5px; line-height:18px; color:#fff;">最多只能购买 '+i+" 件</div>                  </div>";$(t).parents(".td4").append(e)},e.init(),i.init()}),define("app/cartIndex",function(){});