/*! artDialog v6.0.5 | https://github.com/aui/artDialog */

/*!
     * PopupJS
     * Date: 2014-11-09
     * https://github.com/aui/popupjs
     * (c) 2009-2014 TangBin, //www.planeArt.cn
     *
     * This is licensed under the GNU LGPL, version 2.1 or later.
     * For details, see: //www.gnu.org/licenses/lgpl-2.1.html
     */

/*!
     * artDialog
     * Date: 2014-11-09
     * https://github.com/aui/artDialog
     * (c) 2009-2014 TangBin, //www.planeArt.cn
     *
     * This is licensed under the GNU LGPL, version 2.1 or later.
     * For details, see: //www.gnu.org/licenses/lgpl-2.1.html
     */

define("tips",[],function(){function t(t,e){return this.each(function(){var i=$(this),s='<div class="tips_layer" style="position: absolute; border-radius:5px; background-color:#ff6600; display:none; z-index:995">                    <div class="tips-text" style="padding:2px 5px; line-height:18px; color:#fff;">'+t+'</div>                    <div class="diamond"></div>                </div>';$(".tips_layer")&&$(".tips_layer").remove(),$(s).appendTo("body");var a=($(".tips-text"),$(".tips_layer"));e?a.css({top:e.top,left:e.left}).show():a.css({top:i.offset().top-parseInt(i.height())-10,left:i.offset().left+parseInt(i.width()/2)-30}).show(),setTimeout(function(){a.remove()},2e3)})}function e(t,e){var i=$(this);return this.each(function(){var e='<div class="tips-base-layer" style="position: absolute; padding:5px 7px 7px 7px; font-size:14px; color:#fff; border-radius:5px; background-color:#000; opacity:0.8; display:none; z-index:995"><img style="position: relative; top:-1px;" src="//kaluli.hoopchina.com.cn/images/kaluli/order/oder-in.png" /> '+t+'<div style="position: absolute; right:45%; top:32px;"><img src="//kaluli.hoopchina.com.cn/images/kaluli/order/oder-in2.png" /></div></div>';$(".tips-base-layer")&&$(".tips-base-layer").remove(),$(e).appendTo("body"),$(".tips-base-layer").css({top:i.offset().top-parseInt($(".tips-base-layer").height())-20,left:i.offset().left-(i.width()>$(".tips-base-layer").width()?(i.width()-$(".tips-base-layer").width())/2:($(".tips-base-layer").width()-i.width())/2)}).show(),setTimeout(function(){$(".tips-base-layer").remove()},2e3)})}$.fn.tipsFun=e,function(){$.fn.tips=t,$.Jui=$.Jui||{},$.extend($.Jui,{_$:function(t,e){t.siblings().removeClass(e),t.addClass(e)},_showMasks:function(t){var e="<div class='body-mask' style='position:absolute; top:0; left:0; width:100%; height:"+$(document).height()+"px; background-color:#000;  z-index:101;'></div>";$("body").append(e),$(".body-mask").css("opacity",0),$(".body-mask").animate({opacity:t?t:"0.8"})},_closeMasks:function(){var t=$(".body-mask");t.fadeOut(function(){t.remove()})},_getpageSize:function(){var t,e=document.documentElement,i=window.innerWidth||self.innerWidth||e&&e.clientWidth||document.body.clientWidth,s=window.innerHeight||self.innerHeight||e&&e.clientHeight||document.body.clientHeight;return t=[i,s]},_position:function(t){var e=(this._getpageSize()[0]-parseInt(t.outerWidth()))/2,i=(this._getpageSize()[1]-parseInt(t.outerHeight()))/2+$.Jui._getpageScroll();return[e,i]},_getpageScroll:function(){var t;return self.pageYOffset?t=self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?t=document.documentElement.scrollTop:document.body&&(t=document.body.scrollTop),t},isie:!!$.browser.msie,isie6:!!$.browser.msie&&parseInt($.browser.version)<=6,DOC:$(document),WIN:$(window),HEAD:$(document).find("head"),BODY:$(document).find("body")})}(jQuery)}),define("modules/order/priceValue",[],function(){return{productId:$("#item_id").val(),goodsId:$("#sku_id").val(),address_id:$(".address-list .defaults").attr("data-value"),number:$("#numbox-text").text(),remark:"",express_type:$("#sh .icon-check-nosprite").attr("data-type"),express_types:""}}),define("getPrice",["modules/order/priceValue"],function(t){var e={init:function(){},getJson:function(t){$("#cart_data").length>0?this.cartJson(t):this.orderJson(t)},orderJson:function(t){var e="//www.kaluli.com/api/getOrderPrice",i=$("#item_id").val(),s=$("#sku_id").val(),a=$("#numbox-text").text(),o=$(".icon-check-nosprite").parent().attr("data-value"),n=$(".icon-check-nosprite","#coupon-table").parents("tr").attr("data-couponid")||null,r=$(".icon-check-nosprite","#coupon-table").parents("tr").attr("data-coupontype")||1,d=($(".freight").text(),$(".shipping-btn .icon-check-nosprite").attr("data-type")),c=this;console.log("运费类型==================="+d),$.post(e,{id:i,skuId:s,num:a,address_id:o,card_id:n,card_type:r,express_type:d},function(e){var i=$.parseJSON(e);if(t&&t(i),1==i.code){if(!n)return void $(".numbox").tips(i.msg,{left:$(".numbox").offset().left+$(".numbox").outerWidth()+10,top:$(".numbox").offset().top});$("#coupon-table").tips(i.msg,{left:$("#coupon-table").offset().left+130,top:$("#coupon-table").offset().top-40}),i.data.activity&&$(".price-id-6").text(i.data.activity.activity_save+"￥")}else n&&1==n?($(".activity-list").show(),$(".price-id-5").text("￥"+i.data.coupon_fee)):($(".price-id-5").text("￥0"),$(".activity-list").hide());c.getLogistics(i),$(".dutyFee").text("￥"+i.data.total_tax_fee),$(".price-id-1").text("￥"+i.data.total_product_price),$(".price-id-2").text("-￥"+i.data.activity.activity_save),$(".price-id-3").text("￥"+i.data.total_express_fee),$(".price-id-4").text("￥"+i.data.total_tax_fee),n&&1==r?$(".price-id-5").text("-￥"+i.data.coupon_fee):$(".price-id-5").text("-￥0"),$(".price-id-6").text(i.data.total_price);for(var s in i.data.express_list)$(".shipping-btn > i").each(function(){i.data.express_list[s].express_type==$(this).attr("data-type")&&$(this).parent().find(".fee").text("￥"+i.data.express_list[s].fee)})})},cartJson:function(e){var i=[];$(".shipping-btn > .icon-check-nosprite").each(function(){var t={};t.houseId=$(this).attr("houseId"),t.dataType=$(this).attr("data-type"),i.push(t)});var s=JSON.stringify(i),a="//www.kaluli.com/order/cartFreight",o=$("#cart_data").attr("value"),n=$(".icon-check-nosprite").parent().attr("data-value"),r=$(".icon-check-nosprite","#coupon-table").parents("tr").attr("data-couponid")||null,d=$(".icon-check-nosprite","#coupon-table").parents("tr").attr("data-coupontype")||1,c=t.express_type,l=s,u=this;$.post(a,{data:o,address_id:n,card_id:r,card_type:d,express_type:c,express_types:l},function(t){var i=$.parseJSON(t);if(1==i.code)r?($("#coupon-table").tips(i.msg,{left:$("#coupon-table").offset().left+130,top:$("#coupon-table").offset().top-40}),"undefined"!=typeof i.data.activity&&$("#product-discount").length>0&&$("#product-discount i").text(i.data.activity.list.now.price)):$(".address-list").tips(i.info,{left:$(".address-list").offset().left,top:$(".address-list").offset().top}),i.data.activity&&$(".price-id-6").text(i.data.activity.activity_save+"￥");else{$(".price-id-1").text("￥"+i.data.total_data.total_product_price),$(".price-id-2").text("-￥"+i.data.total_data.activity.activity_save),$(".price-id-3").text("￥"+i.data.total_data.total_express_fee),$(".price-id-4").text("￥"+i.data.total_data.total_tax_fee),r&&1==d?$(".price-id-5").text("-￥"+i.data.total_data.coupon_fee):$(".price-id-5").text("-￥0"),$(".price-id-6").text(i.data.total_data.total_price);for(var s in i.data.wareHouseInfo)$(".shipping-btn > i").each(function(){if(s==$(this).attr("houseId")){$(this).parents(".houseName").find(".dutyFee").text("￥"+i.data.wareHouseInfo[s].dutyFee);for(var t=0;t<i.data.wareHouseInfo[s].expressList.length;t++)i.data.wareHouseInfo[s].expressList[t].express_type==$(this).attr("data-type")&&$(this).parent().find(".fee").text("￥"+i.data.wareHouseInfo[s].expressList[t].fee)}})}u.getLogistics(i),e&&e(i)})},getLogistics:function(t){var e=0==t.data.shunfeng_freight?"免邮":t.data.shunfeng_freight+"元";$("#shunfeng").text(t.data.shunfeng_freight),$("#shunfeng_tips").length>0&&$("#shunfeng_tips").text(e)}};return e}),define("modules/order/redeem",["modules/order/priceValue","getPrice"],function(t,e){var i={ajaxLoding:!1,init:function(){this.redeemSubmit(),this.couponClick()},redeemSubmit:function(){var t=[];$(".progrid").each(function(){t.push($(this).attr("data-id"))}),$("input[name=redeemCode]").focus(function(){$(".error-tips").hide()}),$(".redeem-btn").click(function(){$(this).text("正在提交...").css({"background-color":"#999"}).attr("disabled","disabled");var i=$("input[name=redeemCode]").val(),s=$(".price-id-1").attr("data-price");return""==i?void $(".redeem-btn").text("提交").removeAttr("disabled").css("background-color","#f35357"):void $.ajax({url:"//www.kaluli.com/api/getLipinka",dataType:"json",data:{account:i,code:"",item_ids:t,total_price:s},xhrFields:{withCredentials:!0},crossDomain:!0,success:function(t){if($(".redeem-btn").text("提交").removeAttr("disabled").css("background-color","#f35357"),0!=t.status)$(".error-tips").show().text(t.msg);else{$("#redeemCode").text(i),$(".successReddem").show(),$(".normalReddem").hide(),setTimeout(function(){$(".successReddem").hide(),$(".normalReddem").show()},2e3);var s="",a=t.data,o="",n="",r="",d="",c="",l="";$("#coupon-list tr").remove();for(var u=0;u<a.length;u++)a[u].flag?(r="",o="",d=""):(o='class = "coupon-getoff"',r=' style="color:#cccccc;" ',d="<p>该订单中无符合条件商品</p>"),c=a[u].is_simple?"使用范围：卡路里商品":"使用范围：指定商品可用",n=1==a[u].current?"icon-check-nosprite":"",l=""!=a[u].card_limit&&1==a[u].card_type?a[u].card_limit?"满 "+a[u].card_limit_parse.order_money+"元减"+a[u].amount+"元":a[u].amount+"元":a[u].card_limit?"会员权益"+a[u].card_limit_parse.order_money:a[u].amount+"元",s+='<tr data-coupontype="'+a[u].card_type+'" data-couponid="'+a[u].id+'" '+o+'><td class="td1"><i class="'+n+'"></i></td><td class="td2">优惠券:<div class="coupon-text">'+l+'</div></td><td class="td3">'+c+'</td><td class="td4">有效期至：'+a[u].etime+"</td></tr>";$("#coupon-list").append(s),$("#cart_data").length>0?e.cartJson():e.orderJson()}i=$("input[name=redeemCode]").val("")},error:function(){$(".redeem-btn").text("提交").removeAttr("disabled").css("background-color","#f35357"),$(".error-tips").show().text(data.msg)}},"json")})},couponClick:function(){$("#coupon-list").on("click","i",function(){if($(this).parents("tr").hasClass("coupon-getoff"))return!1;if($(".address-list li").length<=1){$.Jui._showMasks(.6);var t="<div id='error-info' style='position:fixed;width:200px;line-height:50px;left:50%;top:50%;margin:-15px 0 0 -50px;z-index:101;background-color:#FFFFFF;font-size:16px;text-align: center;color:red;border-radius: 10px;'>请先添加地址</div>";return $("body").append(t),setTimeout(function(){$("#error-info").remove(),$.Jui._closeMasks(.6)},1e3),!1}var i=$(this);i.hasClass("icon-check-nosprite")?$(this).removeClass("icon-check-nosprite"):($(".td1 i",".coupon-table").removeClass("icon-check-nosprite"),$(this).addClass("icon-check-nosprite")),$("#cart_data").length>0?e.cartJson():e.orderJson()})}};return i}),define("orderConfirm",["modules/order/priceValue","getPrice","modules/order/redeem"],function(t,e,i){var s={Verification:{name:!1,phone:!1,tell:!1,detailed:!1,postal:!0},init:function(t){this.bindFun(),this.cityAdd(),this.cupon(),this.logistics(),i.init()},bindFun:function(){function t(){var t=$("input[name='phonesection']").data("check"),e=$("input[name='phonecode']").data("check"),i=$("input[name='phoneext']").data("check");t&&e?0==i?n.Verification.tell=!1:n.Verification.tell=!0:n.Verification.tell=!1}$(".shuifeipop").hover(function(){$(this).find(".shuifeipop-content").show()},function(){$(this).find(".shuifeipop-content").hide()});var i=/^1[34578][0-9]{9}$/,s=/^[0-9]{3,6}$/,a=/^[0-9]{5,10}$/,o=/^[0-9]{0,5}$/,n=this,r=!1;$("input[name='name']").blur(function(){var t=$(this).val();""==$.trim(t)?($(this).tips("请填写姓名",{left:$(this).offset().left+$(this).outerWidth()+10,top:$(this).offset().top}),n.Verification.name=!1,r=!0):(n.Verification.name=!0,r=!1)}),$("input[name='card']").blur(function(){var t=$(this).val(),e=/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;e.test(t)===!1?($(this).tips("请填写正确的身份证",{left:$(this).offset().left+$(this).outerWidth()+10,top:$(this).offset().top}),r=!0,n.Verification.card=!1):(n.Verification.card=!0,r=!1)}),$("input[name='phone']").blur(function(){var t=$(this).val();i.test(t)?(n.Verification.phone=!0,r=!1):($(this).tips("请填写正确的手机号码",{left:$(this).offset().left+$(this).outerWidth()+10,top:$(this).offset().top}),r=!0,n.Verification.phone=!1)}),$("input[name='phonesection']").blur(function(){var e=$(this).val();s.test(e)||""==$.trim(e)?($(this).data("check",!0),r=!1):($(this).tips("区号必须为3到6位数字",{left:$(this).offset().left+$(this).outerWidth()+10,top:$(this).offset().top}),$(this).data("check",!1),r=!0),t()}),$("input[name='phonecode']").blur(function(){var e=$(this).val();a.test(e)||""==$.trim(e)?($(this).data("check",!0),r=!1):($(this).tips("电话必须为5到10位数字",{left:$(this).offset().left+$(this).outerWidth()+10,top:$(this).offset().top}),$(this).data("check",!1),r=!0),t()}),$("input[name='phoneext']").blur(function(){var e=$(this).val();o.test(e)||""==$.trim(e)?($(this).data("check",!0),r=!1):($(this).tips("电话分机必须少于6个数字",{left:$(this).offset().left+$(this).outerWidth()+10,top:$(this).offset().top}),$(this).data("check",!1),r=!0),t()}),$("input[name='detailed']").blur(function(){var t=$(this).val();""==$.trim(t)?($(this).tips("请填写详细地址",{left:$(this).offset().left+$(this).outerWidth()+10,top:$(this).offset().top}),r=!0,n.Verification.detailed=!1):(n.Verification.detailed=!0,r=!1)}),$("input[name='address']").change(function(t){e.getJson()}),$(".address-editor").find(".save").click(function(t){$(".address-editor").find("input[type=text]").trigger("blur");var i=$(this),s=i.parent().attr("data-value"),a=$("input[name='name']").val(),o=$("input[name=card]").val(),r=$("input[name='phone']").val(),d=$("input[name='phonesection']").val(),c=$("input[name='phonecode']").val(),l=$("input[name='phoneext']").val(),u=$(".sel-1").val(),p=$(".sel-2").val(),f=$(".sel-3").val(),h=$("input[name='detailed']").val(),v="000000",m=$("input[name='is_identify']").val();if("checked"==$("input[name='defaultflag']").attr("checked")?defaultflagVal=1:defaultflagVal=0,($(".a-l-box li").length<3||0==$(".defaultsAddress").length)&&(defaultflagVal=1),!n.Verification.name)return $("input[name='name']").blur(),!1;if(!n.Verification.phone)return $("input[name='phone']").blur(),!1;if(""!=$.trim($("input[name='phonesection']").val())&&""!=$.trim($("input[name='phonecode']").val())&&""!=$.trim($("input[name='phoneext']").val())&&!n.Verification.tell)return $("input[name='phonecode']").tips("请正确填写电话号码",{left:$("input[name='phonecode']").offset().left+$(this).outerWidth()+10,top:$("input[name='phonecode']").offset().top}),!1;if(!n.Verification.detailed)return $("input[name='detailed']").blur(),!1;if(!n.Verification.postal)return $("input[name='postal']").blur(),!1;var g={id:s,identity_number:o,name:a,mobile:r,phonesection:d,phonecode:c,phoneext:l,province:u,city:p,area:f,street:h,postcode:v,is_identify:m,defaultflag:defaultflagVal};$.post("//www.kaluli.com/api/editAddress",{address:g},function(t){if(-1*t.code==10)$.each(t.data.data,function(t,e){i.tips(e)});else{if(""!=s){var a=$(".address-editor").attr("data-index");$(".a-l-box li:eq("+a+")").find("p").html(t.data.data.data),1==m&&(console.log($(".a-l-box li:eq("+a+")")),$(".a-l-box li:eq("+a+") .add-cart").hide()),1==defaultflagVal?($(".defaultsAddress").remove(),$(".defaults").removeClass("defaults"),$(".a-l-box li:eq("+a+")").hasClass("chosen")&&$(".a-l-box li:eq("+a+")").addClass("defaults").append('<span class="chosen defaultsAddress">默认地址1</span>').addClass("defaults")):$(".a-l-box li:eq("+a+")").removeClass("defaults").find(".defaultsAddress").remove()}else{var o=1==defaultflagVal?"defaults":"",r="<li data-value="+t.data.data.id+" class="+o+" >";r+='<i class="icon-check-nosprite"></i>',r+="<p>"+t.data.data.data+"</p>",r+='<div class="editorBtn"><div class="editor">修改</div>|<div class="delete">删除</div></div>',1==defaultflagVal&&($(".a-l-box li").find(".defaultsAddress").remove(),r+='<span class="chosen defaultsAddress">默认地址</span>'),r+="</li>",$(".a-l-box ul").prepend(r)}$(".address-editor").hide(),$(".newAddress i").attr("class",""),n.clearAddress(),e.getJson()}},"json")}),$(".add_new_address").change(function(){$(".address-ul").show()})},callback:function(){},clearAddress:function(){$("input[name='name']").val(""),$("input[name='card']").val(""),$("input[name='phone']").val(""),$("input[name='phonesection']").val(""),$("input[name='phonecode']").val(""),$("input[name='phoneext']").val(""),$("input[name='detailed']").val(""),$("input[name='postal']").val(""),$("input[name='defaultflag']").removeAttr("checked")},cityAdd:function(){var t=$(".select_city"),i=this;t.find(".sel-1").change(function(t){var s=$(this).val();$(".select_city").find(".sel-2").html('<option value="0">请选择</option>'),$(".select_city").find(".sel-3").html('<option value="0">请选择</option>'),$.get("//www.kaluli.com/api/getNextRegionById?id="+s,function(t){i.cityAddstr(t,$(".select_city").find(".sel-2"))},"json"),e.getJson()}),t.find(".sel-2").change(function(t){var s=$(this).val();$.get("//www.kaluli.com/api/getNextRegionById?id="+s,function(t){i.cityAddstr(t,$(".select_city").find(".sel-3"))},"json"),e.getJson()})},cityAddstr:function(t,e){for(var i=["<option>请选择</option>"],s=0,a=t.data.list.length;s<a;s++)i.push('<option value="'+t.data.list[s].region_id+'">'+t.data.list[s].region_name+"</option>"),i.join("");e.html(i)},cupon:function(){},logistics:function(){$(".shipping-btn > i").click(function(){var i=$(".icon-check-nosprite").parent().attr("data-value");if($(this).hasClass("icon-check-nosprite"))return!1;if(void 0==i||null==i){$.Jui._showMasks(.6);var s="<div id='error-info' style='position:fixed;width:200px;line-height:50px;left:50%;top:50%;margin:-15px 0 0 -50px;z-index:101;background-color:#FFFFFF;font-size:16px;text-align: center;color:red;border-radius: 10px;'>请先勾选地址</div>";return $("body").append(s),setTimeout(function(){$("#error-info").remove(),$.Jui._closeMasks(.6)},1e3),!1}if($(".address-list li").length<=1){$.Jui._showMasks(.6);var s="<div id='error-info' style='position:fixed;width:200px;line-height:50px;left:50%;top:50%;margin:-15px 0 0 -50px;z-index:101;background-color:#FFFFFF;font-size:16px;text-align: center;color:red;border-radius: 10px;'>请先添加地址</div>";return $("body").append(s),setTimeout(function(){$("#error-info").remove(),$.Jui._closeMasks(.6)},1e3),!1}var a=$(this);if(a.parents(".houseName").find("i").removeClass("icon-check-nosprite"),a.parents(".houseName").find("span").removeClass("red"),$(this).addClass("icon-check-nosprite"),$(this).parent().find("span").addClass("red"),t.express_type=$(this).data("type"),$("#cart_data").length>0){var o=[];$(".shipping-btn > .icon-check-nosprite").each(function(){var t={};t.houseId=$(this).attr("houseId"),t.dataType=$(this).attr("data-type"),o.push(t)});var n=JSON.stringify(o);t.express_types=n,e.cartJson()}else e.orderJson()})}};return s}),define("chooseAddress",["modules/order/priceValue","orderConfirm","getPrice"],function(t,e,i){function s(){}return s.prototype={defaults:{wrap:".a-l-box",ele:".a-l-box li",checkon:"icon-check-nosprite",newAddressBtn:"newAddress",editaddress:".address-editor",editorBtn:".editor",deleteBtn:".delete",defaultAddressBtn:".set-default-address",province:".sel-1",city:".sel-2",area:".sel-3",success:0},init:function(){var t=this;e.init(),t.selectAddress(),t.deleteAddress(),t.editnewAddress(),t.setDefaultAddress()},selectAddress:function(){function t(t){var i=$(t);i.find("i").hasClass(n.defaults.checkon)?(i.find("i").removeClass(n.defaults.checkon),$(n.defaults.editaddress).hide()):($(n.defaults.ele).find("i").removeClass(n.defaults.checkon),i.find("i").addClass(n.defaults.checkon),$(n.defaults.editaddress).attr("data-value",""),$(n.defaults.editaddress).show()),e.clearAddress()}function s(t){var e=$(t),i=$(t).parent();e.hasClass(n.defaults.checkon)&&e.siblings("span")||($(n.defaults.ele).find("i").removeClass(n.defaults.checkon),e.addClass(n.defaults.checkon),$(n.defaults.ele).removeClass("active"),i.addClass("active")),e.parent().hasClass("newAddress")||$(n.defaults.editaddress).hide()}function a(t){var e=$(t);1==n.defaults.success&&($("."+n.defaults.newAddressBtn).unbind("click"),e.find("i").unbind("click"))}function o(e){var a=$(e).parent();$(e);a.hasClass(n.defaults.newAddressBtn)?t(a):(s(e),i.getJson())}var n=this,r=$(n.defaults.wrap).find("li").length-1;$(n.defaults.wrap).find("li").each(function(t){a(this),r==t&&(n.defaults.success=1)}),$("i",n.defaults.ele).live("click",function(){o(this)}),$("p",n.defaults.ele).live("click",function(){$(this).siblings("i").trigger("click")})},editnewAddress:function(){var t=this,e="//www.kaluli.com/api/getAddress";$(t.defaults.editorBtn).live("click",function(i){$(t.defaults.ele).removeClass("active");var s=$(this).parents("li"),a=s.attr("data-value"),o=s.index();$(t.defaults.ele).find("i").removeClass(t.defaults.checkon),s.find("i").addClass(t.defaults.checkon),s.addClass("active"),$.post(e,{id:a},function(e){var i=$.parseJSON(e).data,s={name:i.name,card:i.identity_number,phone:i.mobile,phonesection:i.phonesection,phoneext:i.phoneext,phonecode:i.phonecode,province:i.province,city:i.city,area:i.area,detailed:i.street,postal:i.postcode};for(var n in s)$("input[name="+n+"]").val(s[n]);1==i.defaultflag&&$("input[name=defaultflag]").attr("checked","checked");var r=$("option[value="+s.province+"]",t.defaults.province).index();$(t.defaults.province)[0].selectedIndex=r,$.get("//www.kaluli.com/api/getNextRegionById?id="+s.province,function(e){t.cityAddstr(e,$(".select_city").find(".sel-2"));var i=$("option[value="+s.city+"]",t.defaults.city).index();$(t.defaults.city)[0].selectedIndex=i,$.get("//www.kaluli.com/api/getNextRegionById?id="+s.city,function(e){t.cityAddstr(e,$(".select_city").find(".sel-3"));var i=$("option[value="+s.area+"]",t.defaults.area).index();$(t.defaults.area)[0].selectedIndex=i},"json")},"json"),$(t.defaults.editaddress).attr({"data-value":a,"data-index":o}).show()}),i.stopPropagation()})},cityAddstr:function(t,e){for(var i=["<option>请选择</option>"],s=0,a=t.data.list.length;s<a;s++)i.push('<option value="'+t.data.list[s].region_id+'">'+t.data.list[s].region_name+"</option>"),i.join("");e.html(i)},deleteAddress:function(){var t=this,e="//www.kaluli.com/api/delAddress";$(t.defaults.ele).each(function(){var i=$(this),s=i.data("value");$(this).find(t.defaults.deleteBtn).click(function(){$.post(e,{id:s},function(t){i.remove()})})})},setDefaultAddress:function(){var t=this,e="//www.kaluli.com/api/setDefaultAddress";$(t.defaults.ele).each(function(t){var i=$(this),s=($(this).find("i"),i.data("value"));i.find(".init").click(function(){var t=$(this);$.post(e,{id:s},function(e){$(".init").removeClass("chosen").addClass("set-default-address").text("设置默认地址"),t.removeClass("set-default-address").addClass("chosen").text("默认地址")})})})}},s}),define("changenum",[],function(){"use strict";function t(t){this.opt=void 0!==t?t:""}var e;return t.prototype={defaults:{wrap:".numbox",subtract:".icon-subtract-nosprite",add:".icon-add--nosprite",textbox:"#numbox-text"},init:function(){var t=this;$.extend(t.defaults,t.opt),t.inputchange(t.callback),t.subtract(t.callback),t.add(t.callback)},inputchange:function(t){var e=this;$(e.defaults.textbox).each(function(){$(this).bind("input propertychange",function(){var i=$(this),s=i.val(),a=$("#stock").length>0?parseInt($("#stock").text()):parseInt($(this).parent().find(".numbox-text").attr("maxstock"));s<=0||"undefined"==typeof s?($(this).siblings(e.defaults.subtract).addClass("nodrop"),$(".error-msg .busnum").addClass("show")):s>a?($(this).siblings(e.defaults.add).addClass("nodrop"),$(".error-msg .busnum").addClass("show"),e.overstock(this)):($(this).siblings(e.defaults.subtract).removeClass("nodrop"),$(this).siblings(e.defaults.add).removeClass("nodrop"),$(".error-msg .busnum").removeClass("show")),t(this)})})},subtract:function(t){var i=this;$(i.defaults.subtract).each(function(){$(this).click(function(){var s=$(this);if(e=s.siblings(i.defaults.textbox).val(),1==e)return s.addClass("nodrop"),!1;s.siblings(i.defaults.add).removeClass("nodrop"),s.removeClass("nodrop"),$(".error-msg .busnum").removeClass("show"),i.roll(s.parent(),e,"down"),e--;var a=Math.round(0+parseInt(e));return s.siblings(i.defaults.textbox).val(a),t(this),!1})})},add:function(t){var i=this;$(i.defaults.add).each(function(){$(this).click(function(){var s=$(this),a=$("#stock").length>0?parseInt($("#stock").text()):parseInt($(this).parent().find(".numbox-text").attr("maxstock"));if(e=s.siblings(i.defaults.textbox).val(),e>=a)return s.addClass("nodrop"),i.overstock(this),!1;s.siblings(i.defaults.subtract).removeClass("nodrop"),s.removeClass("nodrop"),$(".error-msg .busnum").removeClass("show"),i.roll(s.parent(),e,"up"),e++;var o=Math.round(0+parseInt(e));return s.siblings(i.defaults.textbox).val(o),t(this),!1})})},roll:function(t,e,i){var s,a,o,n;if("up"==i)s=parseInt(e)+1,a=-22,o=1,n="vbottom";else{if("down"!=i)return!1;s=parseInt(e)-1,a=27,o=1,n="vtop"}var r='<div class="rollstocknum"><div class="v v1">'+e+'</div><div class="v v2 '+n+'">'+s+"</div></div>";$(t).append(r),$(".rollstocknum").show(),$(".v1").stop().animate({top:a+"px"},150),$(".v2").stop().animate({top:o+"px"},150,function(){$(".rollstocknum").remove()})},callback:function(t){},overstock:function(t){}},t}),!function(){function t(e){var s=i[e],a="exports";return"object"==typeof s?s:(s[a]||(s[a]={},s[a]=s.call(s[a],t,s[a],s)||s[a]),s[a])}function e(t,e){i[t]=e}var i={};e("jquery",function(){return jQuery}),e("popup",function(t){function e(){this.destroyed=!1,this.__popup=i("<div />").css({display:"none",position:"absolute",outline:0}).attr("tabindex","-1").html(this.innerHTML).appendTo("body"),this.__backdrop=this.__mask=i("<div />").css({opacity:.7,background:"#000"}),this.node=this.__popup[0],this.backdrop=this.__backdrop[0],s++}var i=t("jquery"),s=0,a=!("minWidth"in i("html")[0].style),o=!a;return i.extend(e.prototype,{node:null,backdrop:null,fixed:!1,destroyed:!0,open:!1,returnValue:"",autofocus:!0,align:"bottom left",innerHTML:"",className:"ui-popup",show:function(t){if(this.destroyed)return this;var s=this.__popup,n=this.__backdrop;if(this.__activeElement=this.__getActive(),this.open=!0,this.follow=t||this.follow,!this.__ready){if(s.addClass(this.className).attr("role",this.modal?"alertdialog":"dialog").css("position",this.fixed?"fixed":"absolute"),a||i(window).on("resize",i.proxy(this.reset,this)),this.modal){var r={position:"fixed",left:0,top:0,width:"100%",height:"100%",overflow:"hidden",userSelect:"none",zIndex:this.zIndex||e.zIndex};s.addClass(this.className+"-modal"),o||i.extend(r,{position:"absolute",width:i(window).width()+"px",height:i(document).height()+"px"}),n.css(r).attr({tabindex:"0"}).on("focus",i.proxy(this.focus,this)),this.__mask=n.clone(!0).attr("style","").insertAfter(s),n.addClass(this.className+"-backdrop").insertBefore(s),this.__ready=!0}s.html()||s.html(this.innerHTML)}return s.addClass(this.className+"-show").show(),n.show(),this.reset().focus(),this.__dispatchEvent("show"),this},showModal:function(){return this.modal=!0,this.show.apply(this,arguments)},close:function(t){return!this.destroyed&&this.open&&(void 0!==t&&(this.returnValue=t),this.__popup.hide().removeClass(this.className+"-show"),this.__backdrop.hide(),this.open=!1,this.blur(),this.__dispatchEvent("close")),this},remove:function(){if(this.destroyed)return this;this.__dispatchEvent("beforeremove"),e.current===this&&(e.current=null),this.__popup.remove(),this.__backdrop.remove(),this.__mask.remove(),a||i(window).off("resize",this.reset),this.__dispatchEvent("remove");for(var t in this)delete this[t];return this},reset:function(){var t=this.follow;return t?this.__follow(t):this.__center(),this.__dispatchEvent("reset"),this},focus:function(){var t=this.node,s=this.__popup,a=e.current,o=this.zIndex=e.zIndex++;if(a&&a!==this&&a.blur(!1),!i.contains(t,this.__getActive())){var n=s.find("[autofocus]")[0];!this._autofocus&&n?this._autofocus=!0:n=t,this.__focus(n)}return s.css("zIndex",o),e.current=this,s.addClass(this.className+"-focus"),this.__dispatchEvent("focus"),this},blur:function(){var t=this.__activeElement,e=arguments[0];return e!==!1&&this.__focus(t),this._autofocus=!1,this.__popup.removeClass(this.className+"-focus"),this.__dispatchEvent("blur"),this},addEventListener:function(t,e){return this.__getEventListener(t).push(e),this},removeEventListener:function(t,e){for(var i=this.__getEventListener(t),s=0;s<i.length;s++)e===i[s]&&i.splice(s--,1);return this},__getEventListener:function(t){var e=this.__listener;return e||(e=this.__listener={}),e[t]||(e[t]=[]),e[t]},__dispatchEvent:function(t){var e=this.__getEventListener(t);this["on"+t]&&this["on"+t]();for(var i=0;i<e.length;i++)e[i].call(this)},__focus:function(t){try{this.autofocus&&!/^iframe$/i.test(t.nodeName)&&t.focus()}catch(t){}},__getActive:function(){try{var t=document.activeElement,e=t.contentDocument,i=e&&e.activeElement||t;return i}catch(t){}},__center:function(){var t=this.__popup,e=i(window),s=i(document),a=this.fixed,o=a?0:s.scrollLeft(),n=a?0:s.scrollTop(),r=e.width(),d=e.height(),c=t.width(),l=t.height(),u=(r-c)/2+o,p=382*(d-l)/1e3+n,f=t[0].style;f.left=Math.max(parseInt(u),o)+"px",f.top=Math.max(parseInt(p),n)+"px"},__follow:function(t){var e=t.parentNode&&i(t),s=this.__popup;if(this.__followSkin&&s.removeClass(this.__followSkin),e){var a=e.offset();if(a.left*a.top<0)return this.__center()}var o=this,n=this.fixed,r=i(window),d=i(document),c=r.width(),l=r.height(),u=d.scrollLeft(),p=d.scrollTop(),f=s.width(),h=s.height(),$=e?e.outerWidth():0,v=e?e.outerHeight():0,m=this.__offset(t),g=m.left,b=m.top,_=n?g-u:g,x=n?b-p:b,y=n?0:u,k=n?0:p,w=y+c-f,C=k+l-h,A={},I=this.align.split(" "),V=this.className+"-",J={top:"bottom",bottom:"top",left:"right",right:"left"},j={top:"top",bottom:"top",left:"left",right:"left"},N=[{top:x-h,bottom:x+v,left:_-f,right:_+$},{top:x,bottom:x-h+v,left:_,right:_-f+$}],L={left:_+$/2-f/2,top:x+v/2-h/2},E={left:[y,w],top:[k,C]};i.each(I,function(t,e){N[t][e]>E[j[e]][1]&&(e=I[t]=J[e]),N[t][e]<E[j[e]][0]&&(I[t]=J[e])}),I[1]||(j[I[1]]="left"===j[I[0]]?"top":"left",N[1][I[1]]=L[j[I[1]]]),V+=I.join("-")+" "+this.className+"-follow",o.__followSkin=V,e&&s.addClass(V),A[j[I[0]]]=parseInt(N[0][I[0]]),A[j[I[1]]]=parseInt(N[1][I[1]]),s.css(A)},__offset:function(t){var e=t.parentNode,s=e?i(t).offset():{left:t.pageX,top:t.pageY};t=e?t:t.target;var a=t.ownerDocument,o=a.defaultView||a.parentWindow;if(o==window)return s;var n=o.frameElement,r=i(a),d=r.scrollLeft(),c=r.scrollTop(),l=i(n).offset(),u=l.left,p=l.top;return{left:s.left+u-d,top:s.top+p-c}}}),e.zIndex=1024,e.current=null,e}),e("dialog-config",{backdropBackground:"#000",backdropOpacity:.7,content:'<span class="ui-dialog-loading">Loading..</span>',title:"",statusbar:"",button:null,ok:null,cancel:null,okValue:"ok",cancelValue:"cancel",cancelDisplay:!0,width:"",height:"",padding:"",skin:"",quickClose:!1,cssUri:"../css/ui-dialog.css",innerHTML:'<div i="dialog" class="ui-dialog"><div class="ui-dialog-arrow-a"></div><div class="ui-dialog-arrow-b"></div><table class="ui-dialog-grid"><tr><td i="header" class="ui-dialog-header"><button i="close" class="ui-dialog-close">&#215;</button><div i="title" class="ui-dialog-title"></div></td></tr><tr><td i="body" class="ui-dialog-body"><div i="content" class="ui-dialog-content"></div></td></tr><tr><td i="footer" class="ui-dialog-footer"><div i="statusbar" class="ui-dialog-statusbar"></div><div i="button" class="ui-dialog-button"></div></td></tr></table></div>'}),e("dialog",function(t){var e=t("jquery"),i=t("popup"),s=t("dialog-config"),a=s.cssUri;if(a){var o=t[t.toUrl?"toUrl":"resolve"];o&&(a=o(a),a='<link rel="stylesheet" href="'+a+'" />',e("base")[0]?e("base").before(a):e("head").append(a))}var n=0,r=new Date-0,d=!("minWidth"in e("html")[0].style),c="createTouch"in document&&!("onmousemove"in document)||/(iPhone|iPad|iPod)/i.test(navigator.userAgent),l=!d&&!c,u=function(t,i,s){var a=t=t||{};"string"!=typeof t&&1!==t.nodeType||(t={content:t,fixed:!c}),t=e.extend(!0,{},u.defaults,t),t.original=a;var o=t.id=t.id||r+n,d=u.get(o);return d?d.focus():(l||(t.fixed=!1),t.quickClose&&(t.modal=!0,t.backdropOpacity=0),e.isArray(t.button)||(t.button=[]),void 0!==s&&(t.cancel=s),t.cancel&&t.button.push({id:"cancel",value:t.cancelValue,callback:t.cancel,display:t.cancelDisplay}),void 0!==i&&(t.ok=i),t.ok&&t.button.push({id:"ok",value:t.okValue,callback:t.ok,autofocus:!0}),u.list[o]=new u.create(t))},p=function(){};p.prototype=i.prototype;var f=u.prototype=new p;return u.create=function(t){var s=this;e.extend(this,new i);var a=(t.original,e(this.node).html(t.innerHTML)),o=e(this.backdrop);return this.options=t,
this._popup=a,e.each(t,function(t,e){"function"==typeof s[t]?s[t](e):s[t]=e}),t.zIndex&&(i.zIndex=t.zIndex),a.attr({"aria-labelledby":this._$("title").attr("id","title:"+this.id).attr("id"),"aria-describedby":this._$("content").attr("id","content:"+this.id).attr("id")}),this._$("close").css("display",this.cancel===!1?"none":"").attr("title",this.cancelValue).on("click",function(t){s._trigger("cancel"),t.preventDefault()}),this._$("dialog").addClass(this.skin),this._$("body").css("padding",this.padding),t.quickClose&&o.on("onmousedown"in document?"mousedown":"click",function(){return s._trigger("cancel"),!1}),this.addEventListener("show",function(){o.css({opacity:0,background:t.backdropBackground}).animate({opacity:t.backdropOpacity},150)}),this._esc=function(t){var e=t.target,a=e.nodeName,o=/^input|textarea$/i,n=i.current===s,r=t.keyCode;!n||o.test(a)&&"button"!==e.type||27===r&&s._trigger("cancel")},e(document).on("keydown",this._esc),this.addEventListener("remove",function(){e(document).off("keydown",this._esc),delete u.list[this.id]}),n++,u.oncreate(this),this},u.create.prototype=f,e.extend(f,{content:function(t){var i=this._$("content");return"object"==typeof t?(t=e(t),i.empty("").append(t.show()),this.addEventListener("beforeremove",function(){e("body").append(t.hide())})):i.html(t),this.reset()},title:function(t){return this._$("title").text(t),this._$("header")[t?"show":"hide"](),this},width:function(t){return this._$("content").css("width",t),this.reset()},height:function(t){return this._$("content").css("height",t),this.reset()},button:function(t){t=t||[];var i=this,s="",a=0;return this.callbacks={},"string"==typeof t?(s=t,a++):e.each(t,function(t,o){var n=o.id=o.id||o.value,r="";i.callbacks[n]=o.callback,o.display===!1?r=' style="display:none"':a++,s+='<button type="button" i-id="'+n+'"'+r+(o.disabled?" disabled":"")+(o.autofocus?' autofocus class="ui-dialog-autofocus"':"")+">"+o.value+"</button>",i._$("button").on("click","[i-id="+n+"]",function(t){var s=e(this);s.attr("disabled")||i._trigger(n),t.preventDefault()})}),this._$("button").html(s),this._$("footer")[a?"show":"hide"](),this},statusbar:function(t){return this._$("statusbar").html(t)[t?"show":"hide"](),this},_$:function(t){return this._popup.find("[i="+t+"]")},_trigger:function(t){var e=this.callbacks[t];return"function"!=typeof e||e.call(this)!==!1?this.close().remove():this}}),u.oncreate=e.noop,u.getCurrent=function(){return i.current},u.get=function(t){return void 0===t?u.list:u.list[t]},u.list={},u.defaults=s,u}),window.dialog=t("dialog")}(),define("modules/common/dialog",function(){}),define("submit",["modules/order/priceValue","modules/common/dialog"],function(t,e){var i={ajaxLoding:!1,xBuyAjax:1,init:function(){this.remark(),this.bindFun(),this.colsePop()},colsePop:function(){$(".close-pop-btn").click(function(){$(".error-pop").hide()})},remark:function(){$("#textatea-shuoming").focus(function(){$(this).val()==$(this).attr("data")&&$(this).val("")}),$("#textatea-shuoming").blur(function(){$(this).val()==$(this).attr("data")||""==$.trim($(this).val())?($(this).val($(this).attr("data")),t.remark=""):t.remark=$(this).val()})},bindFun:function(){var e=this;$(".submit-btn").click(function(){if(e.ajaxLoding)return!1;var i=$(this);if(t.number=$("#numbox-text").text(),t.address_id=$(".icon-check-nosprite").parent().attr("data-value"),"undefined"==typeof t.address_id){var s=$(".address-list").offset().top;$(window).scrollTop(s-50),$(".address-list").tips("请设置一个地址",{left:$(".newAddress").offset().left+400,top:$(".newAddress").offset().top+26})}else if(0==$(".defaultsAddress").length){var a=t.address_id;$.post("//www.kaluli.com/api/setDefaultAddress",{id:a})}if(i.addClass("submit-btnCC"),e.ajaxLoding=!0,__dace.sendEvent("kaluli_order_confirm_submit"),1==$("input[name=isActivityPrice]").val())$.post("//www.kaluli.com/api/checkXbuyNotPay",{id:t.productId,skuid:t.goodsId},function(i){if(1==i.status)if($("#cart_data").length>0){var s=[];$(".shipping-btn > .icon-check-nosprite").each(function(){var t={};t.houseId=$(this).attr("houseId"),t.dataType=$(this).attr("data-type"),s.push(t)});var a=JSON.stringify(s);t.express_types=a,e.cartSubmit()}else e.orderSubmit();else 2==i.status?(e.xBuyAjax=0,$(".error-pop").show(),$(".textMsg").html('您有未付款的活动订单，<br><a style="color: #3b5cbd" href="//www.kaluli.com/ucenter/order">快去付款吧</a>')):3==i.status?(e.xBuyAjax=0,$(".error-pop").show(),$(".textMsg").html('活动商品已结束，下次赶早哦~<br>您也可以逛逛其它的，<a href="//www.kaluli.com">商城首页 >></a>')):4==i.status?(e.xBuyAjax=0,$(".error-pop").show(),$(".textMsg").html('活动商品已售罄，下次赶早哦~<br>您也可以逛逛其它的，<a style="color: #3b5cbd" href="//www.kaluli.com">商城首页 >></a>')):(e.xBuyAjax=0,$(".error-pop").show(),$(".textMsg").html(i.msg))},"json");else if($("#cart_data").length>0){var o=[];$(".shipping-btn > .icon-check-nosprite").each(function(){var t={};t.houseId=$(this).attr("houseId"),t.dataType=$(this).attr("data-type"),o.push(t)});var n=JSON.stringify(o);t.express_types=n,e.cartSubmit()}else e.orderSubmit()})},orderSubmit:function(){var e=$(".confirm").find("h4").text().trim(),i=$("#total-price").text();if("南沙保税仓"==e&&i>=2e3)$("#over_price_tip").show();else{var s={product_id:t.productId,goods_id:t.goodsId,address_id:t.address_id,number:t.number,remark:t.remark,card_id:$(".icon-check-nosprite","#coupon-table").parents("tr").attr("data-couponid")||null,card_type:$(".icon-check-nosprite","#coupon-table").parents("tr").attr("data-coupontype")||1,express_type:$(".shipping-btn > .icon-check-nosprite").attr("data-type")},a=this;$.post("//www.kaluli.com/api/submitOrder",{data:s},function(t){var e="string"==typeof t?$.parseJSON(t):t;1==e.status?window.location.href=e.data.pay_url:($(".submit-btn").removeClass("submit-btnCC"),a.ajaxLoding=!1)},"json")}},cartSubmit:function(){var e={cart_data:$("#cart_data").attr("value"),remark:t.remark,address_id:t.address_id,card_id:$(".icon-check-nosprite","#coupon-table").parents("tr").attr("data-couponid")||null,card_type:$(".icon-check-nosprite","#coupon-table").parents("tr").attr("data-coupontype")||1,express_type:t.express_type,express_types:t.express_types},i=this;$.post("//www.kaluli.com/order/cartSubmit",e,function(t){var e="string"==typeof t?$.parseJSON(t):t,s="string"==typeof e?$.parseJSON(e):e;1==s.status?window.location.href=s.data.pay_url:($(".submit-btn").removeClass("submit-btnCC"),i.ajaxLoding=!1)},"json")},ajaxAble:function(){}};return i}),requirejs.config({baseUrl:"//kaluli.hoopchina.com.cn/js/kaluli/",paths:{chooseAddress:"modules/order/chooseAddress",orderConfirm:"modules/order/orderConfirm",tips:"modules/common/tips",changenum:"modules/product/changenum",getPrice:"modules/order/getPrice",submit:"modules/order/submit"},urlArgs:"v="+("undefined"!=typeof GV?GV.VERSION:(new Date).getTime())}),require(["tips","chooseAddress","orderConfirm","changenum","getPrice","submit"],function(t,e,i,s,a,o){var n=new e;n.init();var r=new s;r.callback=function(t){var e=parseInt($(t).parent().find("input").val()),i=parseInt($(t).parent().find("input").attr("maxstock"));e<=i&&$(t).parent().siblings(".maxnumtips").remove(),a.getJson()},r.overstock=function(t){var e=parseInt($(t).parent().find("input").attr("maxstock"));if($(t).parent().siblings(".maxnumtips").length>0)return!1;var i='<div class="maxnumtips" style="width:140px;margin:10px auto 0;border-radius:5px; background-color:#ff6600; display:block; z-index:995">                        <div class="tips-text" style="padding:2px 5px; line-height:18px; color:#fff;">最多只能购买 '+e+" 件</div>                  </div>";$(t).parents("td").append(i)},r.init(),o.init()}),define("app/orderConfirm",function(){});