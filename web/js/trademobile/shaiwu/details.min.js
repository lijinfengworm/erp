var _ajaxG=!0,_pageSize=6,_PageTotal=parseInt($("#js-box").attr("data-pageTotal")/6)+1,_pageNum=1,_toName="",_sendCom=0,_isLiang=0;$(function(){$("#footer .lv,#footer .wa").on("click",function(){var a=$(this).find("i"),b=$(this).find("span"),c=$(this).parent(".footer").find("."+$(this).attr("data-typeN")),d=$(this).attr("data-type"),e="http://m.shihuo.cn/shaiwu/supportAgainst",f={id:productId,type:d},g=this;$.post(e,f,function(d){if(0==d.status)a.hasClass("on")?(a.removeClass("on"),b.html(parseInt(b.text())-1),$(g).find(".num").html("-1").addClass("move")):(a.addClass("on"),b.html(parseInt(b.text())+1),$(g).find(".num").html("+1").addClass("add"),c.find("i").hasClass("on")&&(c.find("span").text(c.find("span").text()-1),c.find("i").removeClass("on"))),setTimeout(function(){$(".num").removeClass("add"),$(".num").removeClass("move")},1e3);else{if(1==d.status)return window.location.href,$.ui.tips("\u8bf7\u5148\u767b\u5f55",function(){location.href=$.ui.loginUrl()}),!1;$.ui.tips(d.msg)}},"json")}),$("#comment-liang .say>.more>a").live("click",function(){var a=$(this).parent(".more").next(".reply");a.show(),$(this).parent(".more").hide();var b=1,c=$(this).attr("data-total");parseInt(c/5)+1;var e=$(this).attr("data-commentId"),f="http://m.shihuo.cn/shaiwu/replyAjax",g={commentId:e,replyPage:b,productId:productId,replySize:5},h=this;$.post(f,g,function(d){if(0==d.status){var f="";$.each(d.data.reply,function(a,b){f+='<li>                        <div class="user">                            <div class="face"><img src="'+b.user_avatar+'"></div>                            <a class="text toAndCom"  href="javascript:void(0);" data-commentid="'+e+'" data-name="'+b.user_name+'">                                <div><span>'+b.user_name+"</span>"+b.content+'</div>                                <p class="time">'+b.created_at+"</p>                            </a>                        </div>                    </li>"}),a.find("ul").append(f);var g=parseInt(c-5*b);g>0?(b++,a.find(".more").find("a").text("\u8fd8\u6709"+g+"\u6761\u56de\u590d"),$(h).attr("data-curpage",b)):a.find(".more").hide()}},"json")}),$("#comment-liang .reply .more>a").live("click",function(){var a=$(this).attr("data-curpage"),b=$(this).attr("data-total");parseInt(b/5)+1;var d=$(this).attr("data-commentId"),e="http://m.shihuo.cn/shaiwu/replyAjax",f={commentId:d,replyPage:a,productId:productId,replySize:5},g=this;$.post(e,f,function(c){if(0==c.status){var e="";$.each(c.data.reply,function(a,b){e+='<li>                        <div class="user">                            <div class="face"><img src="'+b.user_avatar+'"></div>                            <a class="text toAndCom"  href="javascript:void(0);" data-commentid="'+d+'" data-name="'+b.user_name+'">                                <div><span>'+b.user_name+"</span>"+b.content+'</div>                                <p class="time">'+b.created_at+"</p>                            </a>                        </div>                    </li>"}),$(g).parent().prev("ul").append(e);var f=parseInt(b-5*a);f>0?(a++,$(g).text("\u8fd8\u6709"+f+"\u6761\u56de\u590d"),$(g).attr("data-curpage",a)):$(g).parent().hide()}},"json")}),$("#footer .pl").on("click",function(){var a=/iphone|ipad/gi.test(navigator.appVersion);if(a){var b=$("#comment").offset().top-100;$(window).scrollTop(b)}$("#comment").focus()}),$(".toComment").live("click",function(){_isLiang="comment-liang"==$(this).parents("dl").attr("id")?1:0;var a=/iphone|ipad/gi.test(navigator.appVersion);if(a){var b=$("#comment").offset().top-100;$(window).scrollTop(b)}$("#comment").focus(),$("#comment").val(""),$("#saveCom").attr("data-commentId",$(this).attr("data-commentId")),_toName=""}),$(".toAndCom").live("click",function(){_isLiang="comment-liang"==$(this).parents("dl").attr("id")?1:0;var a=/iphone|ipad/gi.test(navigator.appVersion);if(a){var b=$("#comment").offset().top-100;$(window).scrollTop(b)}$("#comment").focus(),$("#saveCom").attr("data-commentId",$(this).attr("data-commentId")),_toName="\u56de\u590d : "+$(this).attr("data-name")+" ",$("#comment").val(_toName)}),$("#saveCom").on("click",function(){var a=$("#comment").val(),b=$(this).attr("data-commentId");if($.trim(a).length>_toName.length){if(b)var c="http://m.shihuo.cn/shaiwu/commentReply",d={commentId:b,content:a,productId:productId};else var c="http://m.shihuo.cn/shaiwu/addComment",d={content:a,productId:productId};$.post(c,d,function(a){if(0==a.status)$(".sendOK").css("top",$(document).height/2),$(".sendOK").show(),$("#comment").val(""),setTimeout(function(){$(".sendOK").hide()},2e3),_sendCom=1,_pageNum=1,loadMore.init(),_isLiang&&loadMore.liangData();else{if(1==a.status)return window.location.href,$.ui.tips("\u8bf7\u5148\u767b\u5f55",function(){location.href=$.ui.loginUrl()}),!1;$.ui.tips(a.msg)}},"json")}else $.ui.tips("\u8bf7\u586b\u5199\u56de\u590d\u5185\u5bb9")}),loadMore.init(),loadMore.liangData(),loadMore.ajaxScroll(),$("#js-box .reply .more>a").live("click",function(){var a=$(this).attr("data-curpage"),b=$(this).attr("data-total"),c=parseInt(b/5)+1;if(1==a){var d=parseInt(b-5);$(this).parent().prev("ul").find("li").show(),c==a||5>=b?$(this).parent().hide():(a++,$(this).text("\u8fd8\u6709"+d+"\u6761\u56de\u590d"),$(this).attr("data-curpage",a))}else{var e=$(this).attr("data-commentId"),f="http://m.shihuo.cn/shaiwu/replyAjax",g={commentId:e,replyPage:a,productId:productId,replySize:5},h=this;$.post(f,g,function(c){if(0==c.status){var d="";$.each(c.data.reply,function(a,b){d+='<li>                            <div class="user">                                <div class="face"><img src="'+b.user_avatar+'"></div>                                <a class="text toAndCom"  href="javascript:void(0);" data-commentid="'+e+'" data-name="'+b.user_name+'">                                    <div><span>'+b.user_name+"</span>"+b.content+'</div>                                    <p class="time">'+b.created_at+"</p>                                </a>                            </div>                        </li>"}),$(h).parent().prev("ul").append(d);var f=parseInt(b-5*a);f>0?(a++,$(h).text("\u8fd8\u6709"+f+"\u6761\u56de\u590d"),$(h).attr("data-curpage",a)):$(h).parent().hide()}},"json")}}),$("#js-box .ding,#comment-liang .ding").live("click",function(){var a=$(this).attr("data-commentId"),b="http://m.shihuo.cn/shaiwu/commentPraise",c={commentId:a,productId:productId},d=this;$.post(b,c,function(a){if(0==a.status)$(d).addClass("checked"),$(d).text(a.data.num);else{if(1==a.status)return window.location.href,$.ui.tips("\u8bf7\u5148\u767b\u5f55",function(){location.href=$.ui.loginUrl()}),!1;$.ui.tips(a.msg)}},"json")}),$("#share").on("click",function(){$(".js_share_box,.js_share_hide").addClass("show")}),$("#js_share_hide,.js_share_hide").on("click",function(){$(".js_share_box,.js_share_hide").removeClass("show")}),$(".share_tsina").on("click",function(){var a="#\u8bc6\u8d27\u6652\u5355#"+share_title+"[@\u8bc6\u8d27 \u4e0d\u53ea\u662f\u6d88\u8d39\uff0c\u66f4\u6709\u6001\u5ea6]",b=encodeURIComponent(document.URL),c=encodeURIComponent(share_pic),d="http://service.weibo.com/share/share.php?status=1&pic="+c+"&url="+b+"&title="+encodeURIComponent(a)+"&appkey=3445570739";return $(".js_share_box,.js_share_hide").removeClass("show"),window.open(d,"_blank"),!1}),$(".share_tqq").on("click",function(){var a=encodeURIComponent("#\u8bc6\u8d27\u6652\u5355#"+share_title+"[@\u8bc6\u8d27 \u4e0d\u53ea\u662f\u6d88\u8d39\uff0c\u66f4\u6709\u6001\u5ea6]"),b=" ",c=encodeURIComponent(document.URL),d=encodeURIComponent(share_pic),e="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?title="+a+"&summary="+encodeURIComponent(b)+"&url="+c+"&pics="+d;return $(".js_share_box,.js_share_hide").removeClass("show"),window.open(e,"_blank"),!1}),$(".share_trr").on("click",function(){var a="\u3010\u8bc6\u8d27\u3011"+share_title,b=encodeURIComponent(window.location.href),c=window.location.href,d=encodeURIComponent(share_pic),e="http://widget.renren.com/dialog/share?resourceUrl="+b+"&srcUrl="+c+"&title="+a+"&pic="+d;return $(".js_share_box,.js_share_hide").removeClass("show"),window.open(e,"_blank"),!1})});var loadMore={ajaxLink:"http://m.shihuo.cn/shaiwu/commentAjax",ajaxScroll:function(){$(window).scroll(function(){$(window).scrollTop()>=$(document).height()-$(window).height()&&_ajaxG&&_PageTotal>=_pageNum&&($("#loadding").show(),loadMore.ajaxData())})},init:function(){this.ajaxData()},ajaxData:function(){var a={page:_pageNum,pagesize:_pageSize,productId:productId},c=$("#js-box"),d=$("#tpl").html();_ajaxG=!1,$.post(this.ajaxLink,a,function(a){if("0"==a.status){$("#loadding").hide(),_pageTotal=a.pages,_pageTotal?$(".null").removeClass("show"):$(".null").addClass("show"),_pageNum+=1,_ajaxG=!0;var b=_.template(d);1==_sendCom?(c.html(b(a)),_sendCom=0):c.append(b(a))}},"json")},liangData:function(){var a="http://m.shihuo.cn/shaiwu/lightComment",b={id:productId},d=$("#tpl_liang").html();$.post(a,b,function(a){if("0"==a.status){a.data.length?$("#comment-liang,h2.liang").show():$("#comment-liang,h2.liang").hide();var b=_.template(d);$("#comment-liang").html(b(a))}},"json")}};