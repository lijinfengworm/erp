<?php

/**
 * TrdAccountHistory
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    HC
 * @subpackage model
 * @author     HoopChina.com Dev Team
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class TrdAccountHistory extends BaseTrdAccountHistory
{
    //加积分类型
    private $_category = array(
        0 => '爆料',
        1 => '晒单',
        2 => '其他',
        3 => '兑换 ',
        4 => '签到',
        5 => '优惠海淘（news）点赞加积分',
        6 => '运动鞋发现（item）点赞加积分',
        7 => '团购点赞加积分',
        8 => '爆料加金币',
        9 => '问答回复加积分',
        10 => '首次登陆送积分',
        11 => '海淘评价',
        12 => '海淘打卡',
        13 => '晒物 ',
        14 => '优惠海淘（news） 无爱加积分',
        15 => '评论点踩赞',
        16 => '全站评论加积分',
        17 => '全站评论删除减积分',
        18 => '晒物被点踩扣积分',
        19 => '2015圣诞活动加积分',
    );

    public function getPublishDate(){
        return $this->created_at;
    }
    
    public function getIntegralOther() {
        if ($this->type == 0){
            return $this->integral;
        }else if ($this->type == 1){
            return $this->integral.'/'.$this->gold;
        } else {
            return $this->gold;
        }
    }
    public function getCategoryOther() {
        if ($this->category == 1){
            return '晒物';
        } else if ($this->category == 2){
            return '其它';
        } else if ($this->category == 0){
            return '爆料';
        } else if ($this->category == 3){
            return '兑换';
        }
    }
    
    public function save(Doctrine_Connection $conn = null) 
    {
        $modifiedFields = $this->getModified(true);     
        parent::save($conn);

        //同步积分日志到个人中心
//        $syncAskKeyArray =array('integral','gold','explanation');
//        if($this->isNew() || array_intersect($syncAskKeyArray,array_keys($modifiedFields)))
//        {        
//            $this->syncAskToSphinx();
//        }
        return $this->getId();
        
    }
    
    //发送消息到个人中心
    public function syncAskToSphinx()
    {
        hcRabbitMQPublisher::getInstance('shihuo_user')->publish(new hcAMQPMessage(array('type'=>'add','uid'=>$this->getHupuUid(),'history_id'=>$this->getId())),'shihuo_user_account_integrallog');
        return true;
    }
}
