<?php

/**
 * TrdMainOrder
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    HC
 * @subpackage model
 * @author     HoopChina.com Dev Team
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class TrdMainOrder extends BaseTrdMainOrder
{
    private $attribulte_array = false;
    //设置属性
    public function set_object_attr($key,$val)
    {
        if($this->attribulte_array === FALSE)
        {
            $this->attribulte_array = parent::getAddressAttr()?json_decode(parent::getAddressAttr(),1):array();
        }
        $this->attribulte_array[$key] = $val;
        $this->setAddressAttr(json_encode($this->attribulte_array));
        return true;
    }
    //获取属性
    public function get_object_attr($key)
    {
        if($this->attribulte_array === FALSE)
        {
            $this->attribulte_array = parent::getAddressAttr()?json_decode(parent::getAddressAttr(),1):array();
        }
        return isset($this->attribulte_array[$key])?$this->attribulte_array[$key]:FALSE;
    }
    public function toArray($deep = true, $prefixKey = false) {
        $result = parent::toArray($deep, $prefixKey);
        $result['name'] = $this->getName();
        $result['postcode'] = $this->getPostcode();
        $result['province'] = $this->getProvince();
        $result['city'] = $this->getCity();
        $result['area'] = $this->getArea();
        $result['mobile'] = $this->getMobile();
        $result['street'] = $this->getStreet();
        $result['identity_number'] = $this->getIdentityNumber();
        return $result;
    }
    public function getName()
    {
        return self::get_object_attr('name');
    }
    public function setName($val)
    {
        return self::set_object_attr('name',$val);
    }
    public function getPostcode()
    {
        return self::get_object_attr('postcode');
    }
    public function setPostcode($val)
    {
        return self::set_object_attr('postcode',$val);
    }
    public function getProvince()
    {
        return self::get_object_attr('province');
    }
    public function setProvince($val)
    {
        return self::set_object_attr('province',$val);
    }
    public function getCity()
    {
        return self::get_object_attr('city');
    }
    public function setCity($val)
    {
        return self::set_object_attr('city',$val);
    }
    public function getArea()
    {
        return self::get_object_attr('area');
    }
    public function setArea($val)
    {
        return self::set_object_attr('area',$val);
    }
    public function getMobile()
    {
        return self::get_object_attr('mobile');
    }
    public function setMobile($val)
    {
        return self::set_object_attr('mobile',$val);
    }
    
    public function getStreet()
    {
        return self::get_object_attr('street');
    }
    public function setStreet($val)
    {
        return self::set_object_attr('street',$val);
    }
    public function getIdentityNumber()
    {
        return self::get_object_attr('identity_number');
    }
    public function setIdentityNumber($val)
    {
        return self::set_object_attr('identity_number',$val);
    }
    
    public function save(Doctrine_Connection $conn = null) 
    {
        $modifiedFields = $this->getModified(true);
        parent::save($conn);
        $syncAskKeyArray =array('tax_status');
        if(!$this->isNew() && array_intersect($syncAskKeyArray,array_keys($modifiedFields)))
        {
            if($this->getTaxStatus() == 2){//笨鸟确认税款
                $tradeBirdexService = new tradeBirdexService();
                $tradeBirdexService->confirmTax($this->getOrderNumber());
            }
        }
        return $this->getId();
        
    }
}
