<?php

/**
 * KllBBMainOrderTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class KllBBMainOrderTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object KllBBMainOrderTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('KllBBMainOrder');
    }
    /**
     * 获得待付款的订单
     * @param $status
     */
    public static function getAllOrderByStatus($status = 1) {
        $data = self::getInstance()->createQuery();
        $data->select("*")
             ->where("status = ?",$status)
             ->orderBy('pay_time desc');
        $order = $data->fetchArray();
        return $order;
    }
    /**
     * 获得考拉定单
     * @param $status
     */
    public static function getAllOrderByStatusAndSource($status = 1, $source = 'kaola') {
        $data = self::getInstance()->createQuery();
        $data->select("*")
             ->where("status = ?",$status)
             ->AndWhere("source = ?",$source)
             ->AndWhere("syn_api != ?", 3)
             ->orderBy('pay_time desc');
        $order = $data->fetchArray();
        return $order;
    }
    //获得一条信息
    public static function getOneByOrderNumber($order_number,$is_toarray = true,$field = '') {
        $info = self::getInstance()
            ->createQuery()
            ->select('*')
            ->andWhere('order_number = ?',$order_number)
            ->fetchOne();
        if(empty($info)) return false;
        if(empty($is_toarray)) return $info;
        $info = $info->toArray();
        if(empty($field)) return $info;
        return $info[$field];
    }
}