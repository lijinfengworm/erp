<?php

/**
 * KaluliArticleTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class KaluliArticleTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object KaluliArticleTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('KaluliArticle');
    }

    public static function houtaGetCount()
    {
        $query = self::getInstance()->createQuery()
            ->orderBy('id desc');
        return $query->count();
    }

    public static function houtaGetList($offset=0, $limit=20)
    {
        $query = self::getInstance()->createQuery()
            ->orderBy('id desc')
            ->offset($offset)
            ->limit($limit);
        return $query->fetchArray();
    }

    /*
     * 获取信息
     * 韩晓林
    */
    public  static  function getMessage($array = array()){
        if(isset($array['limit']))
            $limit = $array['limit'];
        else
            $limit = 30;

        if(isset($array['page']))
            $num = $array['page']*$limit;
        else
            $num = 0;

        if(isset($array['order']))
            $order = $array['order'];
        else
            $order = "created_at DESC";

        $objs = self::getInstance()->createQuery('t')->limit($limit)->offset($num)->orderBy($order);

        if(isset($array['select'])) $objs = $objs->select($array['select']);
        if(isset($array['ids']) && $array['ids']) $objs = $objs->andwhere("t.id  in (" . rtrim(join(",", $array['ids']),',') . ") ");
        if(isset($array['day'])) $objs = $objs->andWhere('t.created_at >= ?',date('Y-m-d H:i:s', strtotime("-{$array['day']} day")));
        if(isset($array['not_id'])  && $array['not_id']) $objs = $objs->andWhere("t.id not in (" . join(",", $array['not_id']) . ") ");

        $objs = $objs->andWhere('t.status = 1');  //条件后置,尽可能过滤最多的选项

        if(isset($array['arr']))
            return $objs = $objs->fetchArray();
        else
            return $objs = $objs->execute();
    }

}