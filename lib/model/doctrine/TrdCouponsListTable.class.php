<?php

/**
 * TrdCouponsListTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class TrdCouponsListTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object TrdCouponsListTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('TrdCouponsList');
    }
    
    public static function myListQuery() {
        $query = self::getInstance()->createQuery('m')
                ->where('m.is_delete = 0')
                ->orderBy('m.created_at desc');
        return $query;
    }
    
    /*
     * 删除单条内容
     */
    public static function deleteMessage($id=0) {
        $queryResult = self::getInstance()->createQuery('m')
                        ->update()
                        ->set('m.is_delete', 1)
                        ->where('m.id =?', $id)
                        ->execute();
        return $queryResult;
    }

    /*
     * 删除多条内容
     */

    public static function deleteMessages($ids) {
        if (empty($ids))
            return false;
        return self::getInstance()->createQuery('m')
                        ->update()
                        ->set('is_delete', 1)
                        ->whereIn('m.id', $ids)
                        ->execute();
    }
    
    public static function getAllList(){
        $date = date('Y-m-d H:i:s',time());
        $query =  self::getInstance()->createQuery('a')
            ->select('*')
            ->where('a.expiry_date > ?', $date)
            ->andWhere('a.is_delete = ?', 0)
            ->orderby("id desc");
            return $query ->execute();
    }

    public static  function getCouponsListById($id)
    {
        return self::getInstance()->createQuery()
            ->where('id = ?',$id)
            ->andWhere('is_delete = ?',0)
            ->limit(1)
            ->fetchOne();
    }


}