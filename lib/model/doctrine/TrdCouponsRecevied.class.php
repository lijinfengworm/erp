<?php

/**
 * TrdCouponsRecevied
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    HC
 * @subpackage model
 * @author     HoopChina.com Dev Team
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class TrdCouponsRecevied extends BaseTrdCouponsRecevied
{
    public function getExchangeTime(){
        return date('Y-m-d H:i:s',$this->recevied_date);
    }
    
    public function save(Doctrine_Connection $conn = null) 
    {
        $modifiedFields = $this->getModified(true);     
        parent::save($conn);

        //同步积分日志到个人中心
//        $syncAskKeyArray =array('list_id','hupu_uid');
//        if($this->isNew() || array_intersect($syncAskKeyArray,array_keys($modifiedFields)))
//        {        
//            $this->syncAskToSphinx();
//        }
        return $this->getId();
        
    }
    
    //发送消息到个人中心
    public function syncAskToSphinx()
    {
        hcRabbitMQPublisher::getInstance('shihuo_user')->publish(new hcAMQPMessage(array('type'=>'add','uid'=>$this->getHupuUid())),'shihuo_user_account_duihuanlog');
        return true;
    }

    public function completeFormatApp()
    {
        $data = array();
        $data['id']       = $this->getId();
        $data['activity_id']    = $this->getActivityId();
        $data['type'] = $this->getType();
        $data['list_id'] = $this->getListId();
        $data['detail_id']   = $this->getDetailId();
        $data['account']   = $this->getAccount();
        $data['pass'] = $this->getPass();
        $data['mobile'] = $this->getMobile();
        $data['hupu_uid'] = $this->getHupuUid();
        $data['hupu_username'] = $this->getHupuUsername();
        $data['recevied_date'] = date("Y-m-d H:i:s",$this->getReceviedDate());
        return $data;
    }


}
