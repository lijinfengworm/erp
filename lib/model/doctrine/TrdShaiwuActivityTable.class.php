<?php

/**
 * TrdShaiwuActivityTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class TrdShaiwuActivityTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object TrdShaiwuActivityTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('TrdShaiwuActivity');
    }
    public static function houtaGetCount()
    {
        return self::getInstance()->createQuery()->count();
    }


    public static function houtaGetList($offset=0,$limit=20)
    {
        $query = self::getInstance()->createQuery()
            ->orderBy('id desc')
            ->offset($offset)
            ->limit($limit);
        return $query->fetchArray();
    }

    public static function getIngActivity()
    {
        $data = CacheModel::getCache();
        if (empty($data))
        {
            $now = time();
            $data = self::getInstance()->createQuery()
                ->select('id,title,stime,etime')
                 ->where('stime <= ?',$now)
                ->andWhere('etime > ?',$now)
                ->orderBy('stime desc')
                ->fetchArray()
            ;
            CacheModel::setCache($data, 60);
        }
        return $data;
    }

    public static function getEdActivity()
    {
        $data = CacheModel::getCache();
        if (empty($data))
        {
            $now = time();
            $data = self::getInstance()->createQuery()
                ->select('id,title,num')
                ->andWhere('etime < ?',$now)
                ->orderBy('num desc')
                ->fetchArray()
            ;
            CacheModel::setCache($data, 60);
        }
        return $data;
    }
}