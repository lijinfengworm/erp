<?php

/**
 * TrdGoodsSupplierCommentTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class TrdGoodsSupplierCommentTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object TrdGoodsSupplierCommentTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('TrdGoodsSupplierComment');
    }

    public static function myListQuery()
    {
        $query = self::getInstance()->createQuery('m')
            ->whereIn('m.status', array(0, 1, 3))
            ->andWhere('m.type = ?', 0)
            ->orderby('m.created_at desc');

        return $query;
    }

    //获取所有的评论
    public static function getByGoodsId($goodsId, $page = 1, $size = 20, $order = 'desc')
    {
        $page = $page < 1  ? 1 : ($page > 100 ? 100 : $page);

        return self::getInstance()->createQuery()
            ->andWhere('goods_id = ?',$goodsId)
            ->andWhere('status = 1')
            ->offset(($page-1)*$size)
            ->limit($size)
            ->orderby('updated_at '.$order)
            ->fetchArray();
    }
}