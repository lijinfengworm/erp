<?php

/**
 * KllOrderSynApiTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class KllOrderSynApiTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object KllOrderSynApiTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('KllOrderSynApi');
    }
    //根据子订单获得父订单
    static function  getOrderSynByChildOrderID($bind = []){
        $sql = self::getInstance()->createQuery();
        //select
        if (!empty($bind['select'])){
            $sql->select($bind['select']);
        } else {
            $sql->select("*");
        }
        //where 简单判断  如果复杂 建议新写函数
        if(!empty($bind['where']) && count($bind['where']) > 0) {
            foreach($bind['where'] as $k=>$v) {
                $sql->addWhere($v);
            }
        }
        if(!empty($bind['or_where']) && count($bind['or_where']) > 0) {
            foreach($bind['or_where'] as $k=>$v) {
                $sql->orWhere($v);
            }
        }

        $data =  $sql->fetchOne();
        return $data;
    }
    static function updateApiOrder($type, $order){
        $ret = self::getInstance()->createQuery("o")->Where("o.order_number = ?", $order)->fetchOne();
        if($type == 0){
            if($ret->getSendGj() == 3){
                $ret->setSendGj(2)->save();
            }
            if($ret->getSendHg() == 3) {
                $ret->setSendHg(2)->save();
            }
        }
        if($type == 1){
            if($ret->getSendGj() == 3){
                $ret->setSendGj(4)->save();
            }
            if($ret->getSendHg() == 3) {
                $ret->setSendHg(4)->save();
            }
        }
        return $ret->save();
    }
}