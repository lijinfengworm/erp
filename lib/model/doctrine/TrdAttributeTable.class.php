<?php

/**
 * TrdAttributeTable
 *
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class TrdAttributeTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object TrdAttributeTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('TrdAttribute');
    }


    /**
     * 通过栏目获取下面的品牌
     */
    public static function getByChildrenIdToBrandData($children_id) {
        //获取品牌和栏目关联的id
        $group = TrdGroupTable::getGroupsByCid($children_id);
        if(empty($group)) return true;
        $_attr = array();
        foreach ($group as $k=>$v) {
            if ($v['usage'] == 2) continue;
            $attribute = TrdAttrGroupTable::getAttrByGid($v['id']);
            if(!empty($attribute)) {
                foreach ($attribute as $kk=>$vv){
                    $_returnArr[$vv['TrdAttribute']['id']]['id'] = trim($vv['TrdAttribute']['id']);
                    $_returnArr[$vv['TrdAttribute']['id']]['name'] = trim($vv['TrdAttribute']['name']);
                }
                $_returnArr = FunBase::my_sort($_returnArr,'name',SORT_ASC,SORT_STRING);
                foreach($_returnArr as $key=>$val) {
                    $_attr[$val['id']] = $val['name'];
                }
            }
        }
        return $_attr;
    }

    //通过品牌获取类型
    public static function getByBrandToModelData($brand_id) {
        $modelData = TrdModelTable::getModelByBid($brand_id);
        $returnArr = array();
        if(!empty($modelData)) {
            foreach ($modelData as $k => $v) {
                $returnArr[$v['id']] = $v['name'];
            }
        }
        return $returnArr;
    }





    public function getBrands($arr){

        $objs = self::getInstance()
            ->createQuery('t')
            ->select('t.name, t.logo,t.id')
            ->andWhere('t.id in (' . implode(',', $arr) . ')')
            ->execute();
        $res = array();
        foreach ($objs as $re) {
            $res[$re->getId()] = array(
                'id' => $re->getId(),
                'name' => $re->getName(),
                'logo' => $re->getLogo(),
            );
        }
        return $res;
    }

}