<?php

/**
 * TrdStoreTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class TrdStoreTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object TrdStoreTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('TrdStore');
    }

    /**
     *
     * 根据id获取菜单名
     */
    public function getStoreNameById($id){
        if (empty($id)) return false;
        return self::getInstance()->createQuery('a')
            ->select('*')
            ->where('a.id = ?', $id)
            ->fetchOne();
    }

    public static function myListQuery() {
        $query = self::getInstance()->createQuery('m')
                ->where('m.is_delete = 0')
                ->orderBy('m.id desc');
        return $query;
    }
    
    /*
     * 删除单条内容
     */
    public static function deleteMessage($id=0) {
        $queryResult = self::getInstance()->createQuery('m')
                        ->update()
                        ->set('m.is_delete', 1)
                        ->where('m.id =?', $id)
                        ->execute();
        return $queryResult;
    }

    /*
     * 删除多条内容
     */

    public static function deleteMessages($ids) {
        if (empty($ids))
            return false;
        return self::getInstance()->createQuery('m')
                        ->update()
                        ->set('is_delete', 1)
                        ->whereIn('m.id', $ids)
                        ->execute();
    }
    
    public static function getAllStoreByType($type = 0){
        $query =  self::getInstance()->createQuery('a')
            ->select('*')
            ->where('a.is_index = ?', 1)
            ->andWhere('a.is_display = ?', 0)
            ->andWhere('a.is_delete = ?', 0)
            ->orderby("a.sort asc,id desc");

        if($type !== false)  $query = $query->andwhere('a.type = ?',$type);

        return $query ->execute();
    }
}