<?php

/**
 * CpsLinkTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class CpsLinkTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object CpsLinkTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('CpsLink');
    }

    public static function houtaGetCount($uid = 0)
    {
        $query = self::getInstance()->createQuery();
        if( !empty($uid) )
        {
            $query->where('uid = ?',$uid);
            $query->andWhere('is_fav = 1');
        }
        return $query->count();
    }

    public static function houtaGetList($offset=0, $limit=20,$uid = 0)
    {
        $query = self::getInstance()->createQuery();
        if( !empty($uid) )
        {
            $query->where('uid = ?',$uid);
            $query->andWhere('is_fav = 1');
        }
        $query->orderBy('id desc')
            ->offset($offset)
            ->limit($limit);
        return $query->fetchArray();
    }

    # 跳转链接
    public static function tranLink($code=null)
    {
        if(empty($code)) return ;
        $data = CacheModel::getCache();
        if (empty($data))
        {
            $tmp = self::getInstance()->createQuery()
                ->select('link')
                ->where('code = ?',$code)
                ->fetchArray()
            ;
            $data = !empty($tmp[0]['link'])?$tmp[0]['link']:'';
            CacheModel::setCache($data, 3600);
        }

        return $data;
    }
}