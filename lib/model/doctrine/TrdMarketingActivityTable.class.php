<?php

/**
 * TrdMarketingActivityTable
 *
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class TrdMarketingActivityTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object TrdMarketingActivityTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('TrdMarketingActivity');
    }

    public static function houtaGetActivity($offset=0 ,$limit =15)
    {
        $query = self::getInstance()->createQuery()
            ->limit($limit)
            ->offset($offset)
            ->orderBy('id desc');
        return $query->fetchArray();
    }

    public static function houtaGetActivityCount()
    {
        $query = self::getInstance()->createQuery()
            ->orderBy('id desc');
        return $query->count();
    }

    //获取全场活动
    public static function getMarketingAudience()
    {
        $time = time();
        $audience = self::getInstance()->createQuery()->select('title,type,mode,scope,attr1,attr2,stime,etime,short_name,intro')
            ->where('scope = ?', 1)
            ->addwhere('status = ?', 3)
            ->addwhere('stime <= ?', $time)
            ->addWhere('etime >= ?', $time)
            ->fetchArray();
        return $audience;
    }

    //根据id获取活动
    public static function getMarketingByIds($ids)
    {
        if (empty($ids)) return false;
        $time = time();
        $belongs_act = self::getInstance()->createQuery()->select('title,type,mode,scope,attr1,attr2,stime,etime,short_name,intro')
            ->whereIn('id', (array)$ids)
            ->addwhere('status = ?', 3)
            ->addwhere('stime <= ?', $time)
            ->addWhere('etime >= ?', $time)
            ->fetchArray();
        return $belongs_act;
    }

    //是否有在线活动
    public static function isOnlineActivity()
    {
        $time = time();
        $audience = self::getInstance()->createQuery()->select('id')
            ->addwhere('status = ?', 3)
            ->addwhere('stime <= ?', $time)
            ->addWhere('etime >= ?', $time)
            ->limit(1)
            ->fetchArray();

        if($audience){
            return true;
        }else{
            return false;
        }
    }
}