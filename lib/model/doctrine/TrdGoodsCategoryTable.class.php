<?php

/**
 * TrdGoodsCategoryTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class TrdGoodsCategoryTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object TrdGoodsCategoryTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('TrdGoodsCategory');
    }

    public static function houtaGetCount()
    {
        return self::getInstance()->createQuery()->where('status = 0')->count();
    }


    public static function houtaGetList($offset=0,$limit=20)
    {
        $connection = Doctrine_Manager::getInstance()->getConnection('trade');
        //SELECT b.name as root_name, a.*, case a.pid WHEN 0 THEN a.id ELSE a.pid end as pid2 FROM `trd_goods_brand` as a left join `trd_goods_brand` as b on a.pid=b.id ORDER BY `pid2` ASC,`pid` ASC
        $query = "SELECT b.name as root_name, a.*, case a.pid WHEN 0 THEN a.id ELSE a.pid end as pid2 FROM trd_goods_category as a left join trd_goods_category as b on a.pid=b.id where a.status= 0 ORDER BY pid2 ASC,pid ASC limit {$offset}, {$limit} ";
        $statement = $connection->execute($query);
        $statement->execute();
        $resultset = $statement->fetchAll(PDO::FETCH_ASSOC);
        return $resultset;
    }

    public static function getRootCategory()
    {
        return self::getInstance()->createQuery()->andWhere('status = 0')->andWhere('pid = 0')->fetchArray();
    }

    public static function getChildCategory($id)
    {
        return self::getInstance()->createQuery()->andWhere('status = 0')->andWhere('pid = ?',$id)->fetchArray();
    }
}