<?php

/**
 * KllArticlesTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class KllArticlesTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object KllArticlesTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('KllArticles');
    }
    //获得所有文章的ID
    public function findArticleID($bind = []){
        $data = self::getInstance()->createQuery();
        if (!empty($bind['select'])){
            $data->select($bind['select']);
        } else {
            $data->select("*");
        }
        //where 简单判断  如果复杂 建议新写函数
        if(!empty($bind['where']) && count($bind['where']) > 0) {
            foreach($bind['where'] as $k=>$v) {
                $data->addWhere($v);
            }
        }
        //wherein
        if(!empty($bind['wherein'])){
            $data->whereIn('id', $bind['wherein']);
        }
        //order InStr
        if(!empty($bind['orderBy'])){
            $data->orderBy($bind['orderBy']);
        }

        //limit
        if (!empty($bind['limit'])){
            $data->limit($bind['limit']);
        }
        $data =  $data->fetchArray();
        return $data;
    }
    public static function getAll($bind = []){
        $data = self::getInstance()->createQuery();
        if (!empty($bind['select'])){
            $data->select($bind['select']);
        } else {
            $data->select("*");
        }
        //where 简单判断  如果复杂 建议新写函数
        if(!empty($bind['where']) && count($bind['where']) > 0) {
            foreach($bind['where'] as $k=>$v) {
                $data->addWhere($v);
            }
        }
        //limit
        if (!empty($bind['limit'])){
            $data->limit($bind['limit']);
        }
        //order
        if (!empty($bind['order'])){
            $data->orderBy($bind['order']);
        } else {
            $data->orderBy('id desc');
        }

        if(!empty($bind['offset'])) {
            $data->offset($bind['offset']);
        }
        $data =  $data->fetchArray();

        if(!empty($bind['is_count'])) {
            $data = $data[0]['num'];
        }

        return $data;
    }
    ////根据文章di获取文章
    public function getArticles($article_id,$limit=10)
    {
//        $time=  strtotime('-'.$day.' days');
//        $now=time();
        $query= self::getInstance()->createQuery()
                ->whereIn('id',$article_id)
//                ->andWhere('add_time>?',$time)
//                ->andWhere('add_time<?',$now)
                ->limit($limit)
                ->fetchArray();
        return $query;        
    }
    ////根据文章id获取标签
    public  function getLabelId($id=0)
    {
        $query= self::getInstance()->createQuery()
                ->select('label')
                ->whereIn('id',$id)
                ->fetchArray();
        return $query;  
    }
    ////文章总数
    public function getCountByCid($bind=[])
    {
        $query= self::getInstance()->createQuery()
                ->select('count(id) as num');
        if($bind['cid'])
        {
            $query->andwhere('cid=?',$bind['cid']);
        }
        if(isset($bind['is_use']))
        {
            $query->andwhere('is_use=?',$bind['is_use']);
        }
                
        $data= $query->fetchOne();
        return $data;
    }
    
}