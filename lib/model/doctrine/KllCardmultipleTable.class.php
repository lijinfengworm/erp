<?php

/**
 * KllCardmultipleTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class KllCardmultipleTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object KllCardmultipleTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('KllCardmultiple');
    }

    /**
     * 获取一条数据
     */
    public static function getOne($key = 'id',$val,$type = 'default') {
        $info = self::getInstance()
            ->createQuery()
            ->select('*')
            ->andWhere($key.' = ?',$val)
            ->fetchOne();
        if(empty($info)) return false;
        if(empty($type) || $type == 'default') return $info;
        if($type == 'array')  return  $info->toArray();
        return false;
    }

    //获取所有马上要开始生成的记录
    public static function  getCreateData($limit = 10,$is_array = true) {
        $data = self::getInstance()
            ->createQuery()
            ->select('*')
            ->andWhere('is_success = ?',KllCardmultiple::$_IS_SUCCESS_CREATEING)
            ->andWhere('status = ?',KllCardmultiple::$_STATUS_OK)
            ->limit($limit)
            ->execute();

        if($is_array) return $data->toArray();
        return $data;
    }


    /**
     * 获取全部的数据
     */
    public static function  getAll($bind = array()) {
        $data = self::getInstance()->createQuery();
        //select
        if (!empty($bind['select'])){
            $data->select($bind['select']);
        } else {
            $data->select("*");
        }
        //where 简单判断  如果复杂 建议新写函数
        if(!empty($bind['where']) && count($bind['where']) > 0) {
            foreach($bind['where'] as $k=>$v) {
                $data->addWhere($v);
            }
        }
        //order
        if (!empty($bind['order'])){
            $data->orderBy($bind['order']);
        } else {
            $data->orderBy('id desc');
        }

        //limit
        if (!empty($bind['limit'])){
            $data->limit($bind['limit']);
        }

        if(!empty($bind['offset'])) {
            $data->offset($bind['offset']);
        }
        $data =  $data->fetchArray();
        if(!empty($bind['is_count'])) {
            $data = $data[0]['num'];
        }
        return $data;
    }


    /**
     * 删除数据
     */
    public static function del_one($id) {
        $data = self::getInstance()
            ->createQuery()
            ->select('*')
            ->andWhere('id = ?',$id)
            ->fetchOne();
        if(empty($data)) return false;
        return  $data->delete();
    }


    /**
     * 判断某个字段是否存在
     */
    public static function hasDataField($field,$value,$id) {
        $flag = self::getInstance()
            ->createQuery()
            ->select('id')
            ->andWhere($field.' = ?',$value);
        if(!empty($id)) {
            $flag->andWhere('id <> ?',$id);
        }
        return $flag->fetchOne();
    }

}